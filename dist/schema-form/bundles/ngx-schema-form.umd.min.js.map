{"version":3,"sources":["../../../projects/schema-form/src/lib/model/actionregistry.ts","../../../node_modules/tslib/tslib.es6.js","../../../projects/schema-form/src/lib/template-schema/field/field.ts","../../../projects/schema-form/src/lib/model/formproperty.ts","../../../projects/schema-form/src/lib/model/typemapping.ts","../../../projects/schema-form/src/lib/model/formpropertyfactory.ts","../../../projects/schema-form/src/lib/model/schemapreprocessor.ts","../../../projects/schema-form/src/lib/model/utils.ts","../../../projects/schema-form/src/lib/model/validatorregistry.ts","../../../projects/schema-form/src/lib/model/bindingregistry.ts","../../../projects/schema-form/src/lib/schemavalidatorfactory.ts","../../../projects/schema-form/src/lib/widgetregistry.ts","../../../projects/schema-form/src/lib/widgetfactory.ts","../../../projects/schema-form/src/lib/terminator.service.ts","../../../projects/schema-form/src/lib/property-binding-registry.ts","../../../projects/schema-form/src/lib/expression-compiler-factory.ts","../../../projects/schema-form/src/lib/log.service.ts","../../../projects/schema-form/src/lib/form.component.ts","../../../projects/schema-form/src/lib/formelement.component.ts","../../../projects/schema-form/src/lib/formelement.action.component.ts","../../../projects/schema-form/src/lib/widgetchooser.component.ts","../../../projects/schema-form/src/lib/model/atomicproperty.ts","../../../projects/schema-form/src/lib/model/objectproperty.ts","../../../projects/schema-form/src/lib/model/arrayproperty.ts","../../../projects/schema-form/src/lib/model/stringproperty.ts","../../../projects/schema-form/src/lib/model/booleanproperty.ts","../../../projects/schema-form/src/lib/model/numberproperty.ts","../../../projects/schema-form/src/lib/widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/array/array.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/button/button.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/object/object.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/checkbox/checkbox.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/file/file.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/integer/integer.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/textarea/textarea.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/radio/radio.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/range/range.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/select/select.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/string/string.widget.ts","../../../projects/schema-form/src/lib/defaultwidgets/defaultwidgetregistry.ts","../../../projects/schema-form/src/lib/defaultwidgets/_directives/disableControl.directive.ts","../../../projects/schema-form/src/lib/default.widget.ts","../../../projects/schema-form/src/lib/schema-form.module.ts","../../../projects/schema-form/src/lib/template-schema/template-schema.service.ts","../../../projects/schema-form/src/lib/template-schema/template-schema-element.ts","../../../projects/schema-form/src/lib/template-schema/button/button.component.ts","../../../projects/schema-form/src/lib/template-schema/field/field-parent.ts","../../../projects/schema-form/src/lib/template-schema/field/item/item.component.ts","../../../projects/schema-form/src/lib/template-schema/field/field.component.ts","../../../projects/schema-form/src/lib/template-schema/template-schema.directive.ts","../../../projects/schema-form/src/lib/template-schema/template-schema.module.ts"],"names":["ActionRegistry","this","actions","prototype","clear","register","actionId","action","get","Injectable","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","call","__extends","TypeError","String","__","constructor","create","__values","o","s","Symbol","iterator","m","i","length","next","value","done","__read","n","r","e","ar","push","error","__spread","arguments","concat","FieldType","FormProperty","schemaValidatorFactory","validatorRegistry","expressionCompilerFactory","schema","parent","path","logger","_value","_errors","_valueChanges","BehaviorSubject","_errorsChanges","_visible","_visibilityChanges","schemaValidator","createValidatorFn","expressionCompilerVisibiltyIf","createExpressionCompilerVisibilityIf","_parent","_root","root","PropertyGroup","_rootName","createRootName","_path","defineProperty","__canonicalPath","canonicalPath","__canonicalPathNotation","replace","RegExp","type","updateValueAndValidity","onlySelf","emitEvent","_updateValue","valueChanges","_runValidation","errors","customValidator","customErrors","findRoot","mergeErrors","setErrors","newErrors","isArray","apply","extendErrors","searchProperty","prop","base","result","getProperty","substr","property","setVisible","visible","__evaluateVisibilityIf","sourceProperty","targetProperty","dependencyPath","expression","valid","expArray","expArray_1","expArray_1_1","expString","indexOf","_expresssion","substring","evaluate","source","target","_canonicalPath","__bindVisibility_oneOf_or_allOf","_this","visibleIfProperty","visibleIf","visibleIfOf","oneOf","allOf","visibleIfOf_1","visibleIfOf_1_1","keys","undefined","propertiesBinding","properties","this_1","findProperties","properties_1","e_3","properties_1_1","valueCheck","_chk","_d","e_4","_e","item","_f","e_5","_g","depPath","props","props_1","e_6","props_1_1","propVal","pipe","map","e_7","e_8","props_2","e_9","props_2_1","visibilityCheck","and","combineLatest","v1","v2","warn","registerMissingVisibilityBinding","values","_i","subscribe","_bindVisibility","this_2","properties_2","e_10","properties_2_1","distinctUntilChanged","formProperty","_propertyBindingRegistry","getPropertyBindingsVisibility","add","propertyPath","paths","findPropertyPaths","paths_1","paths_1_1","parentPath","ix","prePath","subPath","pathFound","arrProp","curreItemPath","endsWith","curreItemPrePath","childrenPathFound","_super","_properties","_propertyProxyHandler","ExtendedProxyHandler","Proxy","subPathIdx","propertyId","forEachChild","fn","forEachChildRecursive","child","_bindVisibilityRecursive","isRoot","set","receiver","_a","propertyValue","indexOfChild","pos","lastIndexOf","toString","getCanonicalPath","recalculateCanonicalPath","propertyGroup","propertyGroupChildren","propertyGroupChildren_1","propertyGroupChildren_1_1","p_path","split","splice","join","children","assertCanonicalPath","rebindAll","findPropertiesToRebind","propertyBindings","rebind","findByDependencyPath","startsWith","uniqueValues","rebind_1","rebind_1_1","rebindAll_1","rebindAll_1_1","_property","rebindPaths","rebindPaths_1","e_14","rebindPaths_1_1","rebindPropPath","rebindProp","rebindVisibility","deleteProperty","PROPERTY_TYPE_MAPPING","FormPropertyFactory","propertyBindingRegistry","createProperty","newProperty","$ref","refSchema","getSchema","isUnionType","isValidNullableUnionType","isAllowedToUsingNullableUnionTypeBySchemaContext","extractTypeFromNullableUnionType","initializeRoot","rootProperty","reset","unionType","some","subType","includes","Number","Integer","Boolean","filter","formatMessage","message","schemaError","mesg","Error","schemaWarning","SchemaPreprocessor","preprocess","jsonSchema","normalizeExtensions","checkProperties","checkAndCreateFieldsets","checkItems","normalizeWidget","recursiveCheck","fieldsets","order","replaceOrderByFieldsets","createFieldsets","checkFieldsUsage","fieldsId","usedFields","fieldset","e_2","fields","fieldId","id","fieldsId_1","fieldsId_1_1","isRequired","required","remainingfieldsId","title","description","name","fieldSchema","widget","items","definitions","removeRecursiveRefProperties","additionalItems","definitionPath","extensions","regex","k","find","match","v","copy","JSON","parse","stringify","ValidatorRegistry","validators","validator","BindingRegistry","bindings","binding","SchemaValidatorFactory","ZSchemaValidatorFactory","createSchemaValidator","zschema","ZSchema","breakOnFirstError","validate","err","getLastErrors","denormalizeRequiredPropertyPaths","ref","compileSchema","getDefinition","getLastError","code","params","foundSchema","slice","forEach","ptr","WidgetRegistry","widgets","setDefaultWidget","defaultWidget","getDefaultWidget","hasWidget","getWidgetType","WidgetFactory","registry","resolver","createWidget","container","componentClass","componentFactory","resolveComponentFactory","createComponent","ComponentFactoryResolver","TerminatorService","onDestroy","Subject","destroy","PropertyBindingTypes","PropertyBindingRegistry","getPropertyBindings","PropertyBindings","visibility","sourcesIndex","SimplePropertyIndexer","dependenciesIndex","sourcePropertyPath","store","results","_b","_c","res","found","getBySourcePropertyPath","createPathIndex","index","findOnlyWithValue","_createPathIndex","_storeIndex","pathIndex","indexPos","pathIndex_1","pathIndex_1_1","key","MARKER","_findInIndex","ixRes","__findIndex","indexerResults","segment","wild","_keys","keys_1","keys_1_1","restPath","restIndex","restParent","restPaths","JEXLExpressionCompilerFactory","createExpressionCompiler","JEXLExpressionCompiler","JEXLExpressionCompilerVisibiltyIf","ExpressionCompilerFactory","context","JEXL.Jexl","evalSync","LOG_LEVEL","InjectionToken","LogService","level","logLevel","isWarnEnabled","isErrorEnabled","isLogEnabled","Optional","Inject","args","DefaultLogService","console","log","useFactory","logService","FormComponent","formPropertyFactory","actionRegistry","bindingRegistry","cdr","terminator","onChange","EventEmitter","modelChange","isValid","onErrorChange","onErrorsChange","writeValue","obj","registerOnChange","onChangeCallback","onValueChanges","bind","registerOnTouched","ngOnChanges","changes","setValidators","setActions","setBindings","firstChange","model","errorsChanges","emit","detectChanges","validatorId","bindingPath","setModel","assign","observers","Component","selector","template","providers","provide","deps","NG_VALUE_ACCESSOR","useExisting","multi","ChangeDetectorRef","Input","Output","FormElementComponent","renderer","elementRef","control","FormControl","buttons","unlisten","ngOnInit","parseButtons","setupBindings","eventId","createBinding","listeners","listen","nativeElement","event","_listeners","_listeners_1","_listeners_1_1","_listener","Function","button","createButtonCallback","parameters","preventDefault","onWidgetInstanciated","canonicalPathNotation","counter","rootName","ngOnDestroy","Renderer2","ElementRef","FormElementComponentAction","widgetFactory","subs","instance","unsubscribe","ViewChild","read","ViewContainerRef","static","WidgetChooserComponent","widgetInstanciated","widgetInfo","widgetInstance","AtomicProperty","setValue","resetValue","default","fallbackValue","_hasValue","ObjectProperty","propertiesId","createProperties","resetProperties","propertySchema","reduceValue","object","ArrayProperty","addItem","addProperty","itemSchema","removeItem","_","idx","array","StringProperty","string","BooleanProperty","boolean","NumberProperty","parseFloat","parseInt","integer","number","ControlWidget","ngAfterViewInit","newValue","messages","errorMessages","Widget","Directive","ArrayLayoutWidget","ObjectLayoutWidget","ArrayWidget","updateButtonDisabledState","trackByIndex","buttonDisabledAdd","isAddButtonDisabled","buttonDisabledRemove","isRemoveButtonDisabled","maxItems","minItems","ObjectWidget","CheckboxWidget","checked","onCheck","el","FileWidget","reader","FileReader","filedata","onloadend","data","window","btoa","onFileChange","$event","file","files","filename","size","encoding","readAsBinaryString","IntegerWidget","TextAreaWidget","RadioWidget","RangeWidget","SelectWidget","StringWidget","getInputType","DefaultWidgetRegistry","ButtonWidget","DisableControlDirective","ngControl","condition","NgControl","moduleProviders","useClass","useValue","SchemaFormModule","forRoot","ngModule","NgModule","imports","CommonModule","FormsModule","ReactiveFormsModule","declarations","DefaultWidget","entryComponents","exports","TemplateSchemaService","changed","TemplateSchemaElement","getTextContent","node","from","childNodes","nodeType","TEXT_NODE","pop","nodeValue","trim","ButtonComponent","label","click","setLabelFromContent","textContent","ngAfterContentInit","forwardRef","FieldParent","getButtons","childButtons","randomString","Math","random","_button","getFieldsValidators","reduce","field","getValidators","getFieldsSchema","ItemComponent","FieldComponent","templateSchemaService","childFields","getOneOf","placeholder","format","readOnly","isFirstChange","childItems","enum","setTitleFromContent","merge","ContentChildren","TemplateSchemaDirective","formComponent","terminatorService","setFormDocumentSchema","previousSchema","requred","SimpleChange","toArray"],"mappings":"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","sourcesContent":["import { Action } from './action';\nimport { Injectable } from \"@angular/core\";\n\n@Injectable()\nexport class ActionRegistry {\n  actions: {[key: string]: Action} = {};\n\n  clear() {\n    this.actions = {};\n  }\n\n  register(actionId: string, action: Action) {\n    this.actions[actionId] = action;\n  }\n\n  get(actionId: string) {\n    return this.actions[actionId];\n  }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { Validator } from '../../model/validator';\nimport {ISchema} from '../../model/ISchema';\n\nexport enum FieldType {\n  String = 'string',\n  Object = 'object',\n  Array = 'array',\n  Boolean = 'boolean',\n  Integer =  'integer',\n  Number = 'number',\n}\n\nexport type TNullableFieldType = [FieldType.String | FieldType.Number | FieldType.Boolean | FieldType.Integer, 'null']\n  | ['null', FieldType.String | FieldType.Number | FieldType.Boolean | FieldType.Integer];\n\nexport interface Field {\n  name: string;\n  required: boolean;\n  getSchema(): ISchema;\n  getButtons(): any;\n  getValidators(): { path: string, validator: Validator }[];\n}\n\n\n","import {BehaviorSubject, combineLatest} from 'rxjs';\nimport {distinctUntilChanged, map} from 'rxjs/operators';\n\nimport {SchemaValidatorFactory} from '../schemavalidatorfactory';\nimport {ValidatorRegistry} from './validatorregistry';\nimport {PropertyBindingRegistry} from '../property-binding-registry';\nimport { ExpressionCompilerFactory, ExpressionCompilerVisibilityIf } from '../expression-compiler-factory';\nimport { ISchema, TSchemaPropertyType } from './ISchema';\nimport { LogService } from '../log.service';\n\nexport abstract class FormProperty {\n  public schemaValidator: Function;\n  public expressionCompilerVisibiltyIf: ExpressionCompilerVisibilityIf;\n\n  _value: any = null;\n  _errors: any = null;\n  private _valueChanges = new BehaviorSubject<any>(null);\n  private _errorsChanges = new BehaviorSubject<any>(null);\n  private _visible = true;\n  private _visibilityChanges = new BehaviorSubject<boolean>(true);\n  private _root: PropertyGroup;\n  private _parent: PropertyGroup;\n  private _path: string;\n  _propertyBindingRegistry: PropertyBindingRegistry;\n  __canonicalPath: string;\n  __canonicalPathNotation: string;\n\n  /**\n   * Provides the unique path of this form element.<br/>\n   * E.g.:\n   * <code>/garage/cars</code>,<br/>\n   * <code>/shop/book/0/page/1/</code>\n   */\n  get _canonicalPath() { return this.__canonicalPath; }\n  set _canonicalPath(canonicalPath: string) {\n    this.__canonicalPath = canonicalPath;\n    this.__canonicalPathNotation = (this.__canonicalPath||'')\n      .replace(new RegExp('^/', 'ig'), '')\n      .replace(new RegExp('/$', 'ig'), '')\n      .replace(new RegExp('/', 'ig'), '.');\n  }\n  /**\n   * Uses the unique path provided by the property <code>_canonicalPath</code><br/>\n   * but converts it to a HTML Element Attribute ID compliant format.<br/>\n   * E.g.:\n   * <code>garage.cars</code>,<br/>\n   * <code>shop.book.0.page.1.</code>\n   */\n  get canonicalPathNotation() { return this.__canonicalPathNotation; }\n\n  private _rootName;\n  /**\n   * Provides the HTML Element Attribute ID/NAME compliant representation\n   * of the root element.<br/>\n   * Represents the HTML FORM NAME.<br/>\n   * Only the root <code>FormProperty</code> will provide a value here.\n   */\n  get rootName() { return this._rootName; }\n\n  constructor(schemaValidatorFactory: SchemaValidatorFactory,\n              private validatorRegistry: ValidatorRegistry,\n              expressionCompilerFactory: ExpressionCompilerFactory,\n              public schema: ISchema,\n              parent: PropertyGroup,\n              path: string,\n              protected logger: LogService) {\n    this.schemaValidator = schemaValidatorFactory.createValidatorFn(this.schema);\n    this.expressionCompilerVisibiltyIf = expressionCompilerFactory.createExpressionCompilerVisibilityIf();\n\n    this._parent = parent;\n    if (parent) {\n      this._root = parent.root;\n    } else if (this instanceof PropertyGroup) {\n      this._root = <PropertyGroup><any>this;\n      this._rootName = this.createRootName();\n    }\n    this._path = path;\n  }\n\n  /**\n   * Creates the HTML ID and NAME attribute compliant string.\n   */\n  private createRootName(): string {\n    if (this.schema && this.schema['name']) {\n      return this._rootName = this.schema['name'].replace(new RegExp('[\\\\s]+', 'ig'), '_')\n    }\n    return '';\n  }\n\n  public get valueChanges() {\n    return this._valueChanges;\n  }\n\n  public get errorsChanges() {\n    return this._errorsChanges;\n  }\n\n  public get type(): TSchemaPropertyType {\n    return this.schema.type;\n  }\n\n  public get parent(): PropertyGroup {\n    return this._parent;\n  }\n\n  public get root(): PropertyGroup {\n    return this._root || <PropertyGroup><any>this;\n  }\n\n  public get path(): string {\n    return this._path;\n  }\n\n  public get value() {\n    return this._value;\n  }\n\n  public get visible() {\n    return this._visible;\n  }\n\n  public get valid() {\n    return this._errors === null;\n  }\n\n  public abstract setValue(value: any, onlySelf: boolean);\n\n  public abstract reset(value: any, onlySelf: boolean);\n\n  public updateValueAndValidity(onlySelf = false, emitEvent = true) {\n    this._updateValue();\n\n    if (emitEvent) {\n      this.valueChanges.next(this.value);\n    }\n\n    this._runValidation();\n\n    if (this.parent && !onlySelf) {\n      this.parent.updateValueAndValidity(onlySelf, emitEvent);\n    }\n\n  }\n\n  /**\n   * @internal\n   */\n  public abstract _hasValue(): boolean;\n\n  /**\n   *  @internal\n   */\n  public abstract _updateValue();\n\n  /**\n   * @internal\n   */\n  public _runValidation(): any {\n    let errors = this.schemaValidator(this._value) || [];\n    let customValidator = this.validatorRegistry.get(this.path);\n    if (customValidator) {\n      let customErrors = customValidator(this.value, this, this.findRoot());\n      errors = this.mergeErrors(errors, customErrors);\n    }\n    if (errors.length === 0) {\n      errors = null;\n    }\n\n    this._errors = errors;\n    this.setErrors(this._errors);\n  }\n\n  private mergeErrors(errors, newErrors) {\n    if (newErrors) {\n      if (Array.isArray(newErrors)) {\n        errors = errors.concat(...newErrors);\n      } else {\n        errors.push(newErrors);\n      }\n    }\n    return errors;\n  }\n\n  private setErrors(errors) {\n    this._errors = errors;\n    this._errorsChanges.next(errors);\n  }\n\n  public extendErrors(errors) {\n    errors = this.mergeErrors(this._errors || [], errors);\n    this.setErrors(errors);\n  }\n\n  searchProperty(path: string): FormProperty {\n    let prop: FormProperty = this;\n    let base: PropertyGroup = null;\n\n    let result = null;\n    if (path[0] === '/') {\n      base = this.findRoot();\n      result = base.getProperty(path.substr(1));\n    } else {\n      while (result === null && prop.parent !== null) {\n        prop = base = prop.parent;\n        result = base.getProperty(path);\n      }\n    }\n    return result;\n  }\n\n  public findRoot(): PropertyGroup {\n    let property: FormProperty = this;\n    while (property.parent !== null) {\n      property = property.parent;\n    }\n    return <PropertyGroup>property;\n  }\n\n  private setVisible(visible: boolean) {\n    this._visible = visible;\n    this._visibilityChanges.next(visible);\n    this.updateValueAndValidity();\n  }\n\n  /**\n   * Making use of the expression compiler for the <code>visibleIf</code> condition\n   * @param sourceProperty The source property where the `visibleIf` condition is set.\n   * @param targetProperty  The target property what provided the `value` on which the `visibleIf` condition will be checked against. May be `null` or `undefined`\n   * @param dependencyPath The dependency path of the `targetProperty`\n   * @param value The value of the `targetProperty` to check the `visiblityIf` condintion against. May be `null` or `undefined`\n   * @param expression The value or expression to check against the `value` for the `targetProperty`. May be `null` or `undefined`\n   */\n  private __evaluateVisibilityIf(\n    sourceProperty: FormProperty,\n    targetProperty: FormProperty,\n    dependencyPath: string,\n    value: any = '',\n    expression: string | string[] | number | number[] | boolean | boolean[]): boolean {\n    try {\n      let valid = false\n      const expArray = Array.isArray(expression) ? expression : [expression]\n      for (const expString of expArray) {\n        if (typeof expString === 'boolean') {\n          valid = !expString ? !value : value\n        } else if (typeof expString === 'number') {\n          valid = !!value ? `${expString}` === `${value}` : false;\n        } else if (-1 !== `${expString}`.indexOf('$ANY$')) {\n          valid = value && value.length > 0;\n        } else if (0 === `${expString}`.indexOf('$EXP$')) {\n          const _expresssion = (expString as string).substring('$EXP$'.length);\n          valid = true === this.expressionCompilerVisibiltyIf.evaluate(_expresssion, {\n            source: sourceProperty,\n            target: targetProperty\n          })\n        } else {\n          valid = !!value ? `${expString}` === `${value}` : false;\n        }\n        if (valid) {\n          break\n        }\n      }\n      return valid\n    } catch (error) {\n      this.logger.error('Error processing \"VisibileIf\" expression for path: ', dependencyPath,\n        `source - ${(sourceProperty ? sourceProperty._canonicalPath : '<no-sourceProperty>')}: `, sourceProperty,\n        `target - ${(targetProperty ? targetProperty._canonicalPath : '<no-targetProperty>')}: `, targetProperty,\n        'value:', value,\n        'expression: ', expression,\n        'error: ', error)\n    }\n  }\n\n  /**\n   * binds visibility conditions of type `oneOf` and `allOf`.\n   * @returns `true` if any visibility binding of type `oneOf` or `allOf` has been processed. Otherwise `false`.\n   */\n  private __bindVisibility_oneOf_or_allOf(): boolean {\n    /**\n     * <pre>\n     *     \"oneOf\":[{\n     *         \"path\":[\"value\",\"value\"]\n     *     },{\n     *         \"path\":[\"value\",\"value\"]\n     *     }]\n     *     </pre>\n     * <pre>\n     *     \"allOf\":[{\n     *         \"path\":[\"value\",\"value\"]\n     *     },{\n     *         \"path\":[\"value\",\"value\"]\n     *     }]\n     *     </pre>\n     */\n    const visibleIfProperty = this.schema.visibleIf;\n    const visibleIfOf = (visibleIfProperty || {}).oneOf || (visibleIfProperty || {}).allOf;\n    if (visibleIfOf) {\n      for (const visibleIf of visibleIfOf) {\n        if (typeof visibleIf === 'object' && Object.keys(visibleIf).length === 0) {\n          this.setVisible(false);\n        } else if (visibleIf !== undefined) {\n          const propertiesBinding = [];\n          for (const dependencyPath in visibleIf) {\n            if (visibleIf.hasOwnProperty(dependencyPath)) {\n              const properties = this.findProperties(this, dependencyPath);\n              if ((properties || []).length) {\n                for (const property of properties) {\n                  if (property) {\n                    let valueCheck;\n                    if (this.schema.visibleIf.oneOf) {\n                      const _chk = (value) => {\n                        for (const item of this.schema.visibleIf.oneOf) {\n                          for (const depPath of Object.keys(item)) {\n                            const props = this.findProperties(this, depPath);\n                            for(const prop of props) {\n                              const propVal = prop ? prop.value : null;\n                              if (this.__evaluateVisibilityIf(this, prop, dependencyPath, propVal, item[depPath])) {\n                                  return true\n                              }\n                            }\n                          }\n                        }\n                        return false;\n                      };\n                      valueCheck = property.valueChanges.pipe(map(_chk));\n                    } else if (this.schema.visibleIf.allOf) {\n                      const _chk = (value) => {\n                        for (const item of this.schema.visibleIf.allOf) {\n                          for (const depPath of Object.keys(item)) {\n                            const props = this.findProperties(this, depPath);\n                            for(const prop of props) {\n                              const propVal = prop ? prop.value : null;\n                              if (!this.__evaluateVisibilityIf(this, prop, dependencyPath, propVal, item[depPath])) {\n                                return false;\n                              }\n                            }\n                          }\n                        }\n                        return true;\n                      };\n                      valueCheck = property.valueChanges.pipe(map(_chk));\n                    }\n                    const visibilityCheck = property._visibilityChanges;\n                    const and = combineLatest([valueCheck, visibilityCheck], (v1, v2) => v1 && v2);\n                    propertiesBinding.push(and);\n                  }\n                }\n              } else {\n                this.logger.warn('Can\\'t find property ' + dependencyPath + ' for visibility check of ' + this.path);\n                this.registerMissingVisibilityBinding(dependencyPath, this);\n                // not visible if not existent\n                this.setVisible(false);\n              }\n            }\n          }\n\n          combineLatest(propertiesBinding, (...values: boolean[]) => {\n            if (this.schema.visibleIf.allOf) {\n              return values.indexOf(false) === -1;\n            }\n            return values.indexOf(true) !== -1;\n          }).subscribe((visible) => {\n            this.setVisible(visible);\n          });\n        }\n      }\n      return true;\n    }\n  }\n\n  // A field is visible if AT LEAST ONE of the properties it depends on is visible AND has a value in the list\n  public _bindVisibility() {\n    if (this.__bindVisibility_oneOf_or_allOf())\n      return;\n    let visibleIf = this.schema.visibleIf;\n    if (typeof visibleIf === 'object' && Object.keys(visibleIf).length === 0) {\n      this.setVisible(false);\n    } else if (visibleIf !== undefined) {\n      let propertiesBinding = [];\n      for (let dependencyPath in visibleIf) {\n        if (visibleIf.hasOwnProperty(dependencyPath)) {\n          const properties = this.findProperties(this, dependencyPath);\n          if ((properties || []).length) {\n            for (const property of properties) {\n              if (property) {\n                const valueCheck = property.valueChanges.pipe(map(\n                  value => this.__evaluateVisibilityIf(this, property, dependencyPath, value, visibleIf[dependencyPath])\n                ));\n                const visibilityCheck = property._visibilityChanges;\n                const and = combineLatest([valueCheck, visibilityCheck], (v1, v2) => v1 && v2);\n                propertiesBinding.push(and);\n              }\n            }\n          } else {\n            this.logger.warn('Can\\'t find property ' + dependencyPath + ' for visibility check of ' + this.path);\n            this.registerMissingVisibilityBinding(dependencyPath, this);\n            // not visible if not existent\n            this.setVisible(false);\n          }\n        }\n      }\n\n      combineLatest(propertiesBinding, (...values: boolean[]) => {\n        return values.indexOf(true) !== -1;\n      }).pipe(distinctUntilChanged()).subscribe((visible) => {\n        this.setVisible(visible);\n      });\n    }\n  }\n\n  private registerMissingVisibilityBinding(dependencyPath: string, formProperty: FormProperty) {\n    formProperty._propertyBindingRegistry.getPropertyBindingsVisibility().add(dependencyPath, formProperty.path);\n  }\n\n\n  /**\n   * Finds all <code>formProperties</code> from a path with wildcards.<br/>\n   * e.g: <code>/garage/cars/&#42;/tires/&#42;/name</code><br/>\n   * @param target\n   * @param propertyPath\n   */\n  findProperties(target: FormProperty, propertyPath: string): FormProperty[] {\n    const props: FormProperty[] = [];\n    const paths = this.findPropertyPaths(target, propertyPath);\n    for (const path of paths) {\n      const p: FormProperty = target.searchProperty(path);\n      if (p) {\n        props.push(p);\n      }\n    }\n    return props;\n  }\n\n  /**\n   * Creates canonical paths from a path with wildcards.\n   * e.g:<br/>\n   * From:<br/>\n   * <code>/garage/cars/&#42;/tires/&#42;/name</code><br/>\n   * it creates:<br/>\n   * <code>/garage/cars/0/tires/0/name</code><br/>\n   * <code>/garage/cars/0/tires/1/name</code><br/>\n   * <code>/garage/cars/0/tires/2/name</code><br/>\n   * <code>/garage/cars/0/tires/3/name</code><br/>\n   * <code>/garage/cars/1/tires/0/name</code><br/>\n   * <code>/garage/cars/2/tires/1/name</code><br/>\n   * <code>/garage/cars/3/tires/2/name</code><br/>\n   * <code>/garage/cars/3/tires/3/name</code><br/>\n   * <code>/garage/cars/&#42;/tires/&#42;/name</code><br/>\n   * <code>/garage/cars/&#42;/tires/2/name</code><br/>\n   * <code>/garage/cars/&#42;/tires/3/name</code><br/>\n   * <br/>etc...\n   * @param target\n   * @param path\n   * @param parentPath\n   */\n  findPropertyPaths(target: FormProperty, path: string, parentPath?: string): string[] {\n    const ix = path.indexOf('*');\n    if (-1 !== ix) {\n      const prePath = ix > -1 ? path.substring(0, ix - 1) : path;\n      const subPath = ix > -1 ? path.substring(ix + 1) : path;\n      const prop: FormProperty = target.searchProperty(prePath);\n      let pathFound = [];\n      if (prop instanceof PropertyGroup) {\n        const arrProp = prop.properties as FormProperty[];\n        for (let i = 0; i < arrProp.length; i++) {\n          const curreItemPath = (parentPath || '') + prePath + (prePath.endsWith('/') ? '' : '/') + i + subPath;\n          const curreItemPrePath = (parentPath || '') + prePath + i;\n          if (-1 === curreItemPath.indexOf('*')) {\n            pathFound.push(curreItemPath);\n          }\n          const childrenPathFound = this.findPropertyPaths(arrProp[i], subPath, curreItemPrePath);\n          pathFound = pathFound.concat(childrenPathFound);\n        }\n      }\n      return pathFound;\n    }\n    return [path];\n  }\n}\n\nexport abstract class PropertyGroup extends FormProperty {\n\n  _properties: FormProperty[] | { [key: string]: FormProperty } = null;\n\n  get properties() {\n    return this._properties;\n  }\n\n  set properties(properties: FormProperty[] | { [key: string]: FormProperty }) {\n    /**\n     * Override the setter to add an observer that notices when an item is added or removed.<br/>\n     */\n    this._properties = new Proxy(properties, this._propertyProxyHandler);\n  }\n  \n  private _propertyProxyHandler = new ExtendedProxyHandler(this.logger)\n\n  getProperty(path: string) {\n    let subPathIdx = path.indexOf('/');\n    let propertyId = subPathIdx !== -1 ? path.substr(0, subPathIdx) : path;\n\n    let property = this.properties[propertyId];\n    if (property !== null && subPathIdx !== -1 && property instanceof PropertyGroup) {\n      let subPath = path.substr(subPathIdx + 1);\n      property = (<PropertyGroup>property).getProperty(subPath);\n    }\n    return property;\n  }\n\n  public forEachChild(fn: (formProperty: FormProperty, str: String) => void) {\n    for (let propertyId in this.properties) {\n      if (this.properties.hasOwnProperty(propertyId)) {\n        let property = this.properties[propertyId];\n        fn(property, propertyId);\n      }\n    }\n  }\n\n  public forEachChildRecursive(fn: (formProperty: FormProperty) => void) {\n    this.forEachChild((child) => {\n      fn(child);\n      if (child instanceof PropertyGroup) {\n        (<PropertyGroup>child).forEachChildRecursive(fn);\n      }\n    });\n  }\n\n  public _bindVisibility() {\n    super._bindVisibility();\n    this._bindVisibilityRecursive();\n  }\n\n  private _bindVisibilityRecursive() {\n    this.forEachChildRecursive((property) => {\n      property._bindVisibility();\n    });\n  }\n\n  public isRoot() {\n    return this === this.root;\n  }\n}\n\n\nexport class ExtendedProxyHandler implements ProxyHandler<FormProperty[] | { [key: string]: FormProperty }> {\n  constructor(private logger: LogService) { }\n  /**\n   * When a new item is added it will be checked for visibility updates to proceed <br/>\n   * if any other field has a binding reference to it.<br/>\n   */\n  set(target: FormProperty[] | { [p: string]: FormProperty }, p: PropertyKey, value: any, receiver: any): boolean {\n\n    /**\n     * 1) Make sure a canonical path is set\n     */\n    const assertCanonicalPath = (propertyValue: any) => {\n      const formProperty = propertyValue as FormProperty;\n      if (Array.isArray(target) && propertyValue instanceof FormProperty) {\n        /**\n         * Create a canonical path replacing the last '*' with the elements position in array\n         * @param propertyPath\n         * @param indexOfChild\n         */\n        const getCanonicalPath = (propertyPath: string, indexOfChild: number) => {\n          let pos;\n          if (propertyPath && -1 !== (pos = propertyPath.lastIndexOf('*'))) {\n            return propertyPath.substring(0, pos) + indexOfChild.toString() + propertyPath.substring(pos + 1);\n          }\n        };\n        if (formProperty) {\n          formProperty._canonicalPath = getCanonicalPath(formProperty._canonicalPath, p as number);\n        }\n      }\n\n      const recalculateCanonicalPath = (formProperty: FormProperty) => {\n        if (!(formProperty instanceof PropertyGroup))\n          return\n        const propertyGroup = formProperty as PropertyGroup;\n        const propertyGroupChildren = (Array.isArray(propertyGroup.properties) ?\n          propertyGroup.properties :\n          Object.values(propertyGroup.properties || {})) as FormProperty[];\n        if (propertyGroupChildren.length || (formProperty.path || '').endsWith('/*')) {\n          /**\n           * If it is an array, then all children canonical paths must be computed now.\n           * The children don't have the parent's path segment set yet,\n           * because they are created before the parent gets attached to its parent.\n           */\n          for (const child of propertyGroupChildren) {\n            if (child.__canonicalPath.indexOf('*')) {\n              const p_path = formProperty._canonicalPath.split('/')\n              child._canonicalPath = p_path.concat(child._canonicalPath.split('/').splice(p_path.length)).join('/')\n            }\n            recalculateCanonicalPath(child)\n          }\n        }\n      }\n      recalculateCanonicalPath(formProperty)\n      const propertyGroup = formProperty as PropertyGroup;\n      const propertyGroupChildren = (Array.isArray(propertyGroup.properties) ?\n      propertyGroup.properties :\n      Object.values(propertyGroup.properties || {})) as FormProperty[];\n      return { property: formProperty, children: propertyGroupChildren };\n    };\n    const { property, children } = assertCanonicalPath(value);\n\n    /**\n     * 2) Add the new property before rebinding, so it can be found by <code>_bindVisibility</code>\n     */\n    const result = target[p as string] = value;\n\n    /**\n     * 3) Re-bind the visibility bindings referencing to this canonical paths\n     */\n    const rebindVisibility = () => {\n      const rebindAll = [property].concat(children);\n      const findPropertiesToRebind = (formProperty: FormProperty) => {\n        const propertyBindings = formProperty._propertyBindingRegistry.getPropertyBindingsVisibility();\n        let rebind: string[] = [];\n        if (formProperty._canonicalPath) {\n          rebind = rebind.concat(rebind.concat(propertyBindings.findByDependencyPath(formProperty._canonicalPath) || []));\n          if (formProperty._canonicalPath.startsWith('/')) {\n            rebind = rebind.concat(rebind.concat(propertyBindings.findByDependencyPath(formProperty._canonicalPath.substring(1)) || []));\n          }\n        }\n        rebind = rebind.concat(propertyBindings.findByDependencyPath(formProperty.path) || []);\n        if (formProperty.path.startsWith('/')) {\n          rebind = rebind.concat(rebind.concat(propertyBindings.findByDependencyPath(formProperty.path.substring(1)) || []));\n        }\n        const uniqueValues = {};\n        for (const item of rebind) {\n          uniqueValues[item] = item;\n        }\n        return Object.keys(uniqueValues);\n      };\n      for (const _property of rebindAll) {\n        if (_property instanceof FormProperty) {\n          try {\n            const rebindPaths = findPropertiesToRebind(_property);\n            for (const rebindPropPath of rebindPaths) {\n              const rebindProp = _property.searchProperty(rebindPropPath);\n              if (!rebindProp) {\n                this.logger.warn('Can\\'t find property to rebind visibility at path:', _property.path, 'property:', _property);\n              } else {\n                rebindProp._bindVisibility();\n              }\n            }\n          } catch (e) {\n            this.logger.error('Rebinding visibility error at path:', _property.path, 'property:', _property, e);\n          }\n        }\n      }\n    };\n    rebindVisibility();\n\n    return result;\n  }\n  get(target: FormProperty[] | { [p: string]: FormProperty }, p: PropertyKey, receiver: any): any {\n    return target[p as string];\n  }\n  deleteProperty(target: FormProperty[] | { [p: string]: FormProperty }, p: PropertyKey): boolean {\n    return delete target[p as string];\n  }\n}\n","import { FieldType } from '../template-schema/field/field';\n\nexport type TPropertyTypeMapping = { [type in FieldType]?: any };\n\nexport const PROPERTY_TYPE_MAPPING: TPropertyTypeMapping  = {};\n","import { FormProperty, PropertyGroup } from './formproperty';\nimport { SchemaValidatorFactory } from '../schemavalidatorfactory';\nimport { ValidatorRegistry } from './validatorregistry';\nimport { PropertyBindingRegistry } from '../property-binding-registry';\nimport { ExpressionCompilerFactory } from '../expression-compiler-factory';\nimport { PROPERTY_TYPE_MAPPING } from './typemapping';\nimport { ISchema, TSchemaPropertyType } from './ISchema';\nimport { LogService } from '../log.service';\nimport { TNullableFieldType, FieldType } from '../template-schema/field/field';\n\nexport class FormPropertyFactory {\n\n  constructor(private schemaValidatorFactory: SchemaValidatorFactory, private validatorRegistry: ValidatorRegistry,\n              private propertyBindingRegistry: PropertyBindingRegistry,\n              private expressionCompilerFactory: ExpressionCompilerFactory,\n              private logger: LogService) {\n  }\n\n  createProperty(schema: ISchema, parent: PropertyGroup = null, propertyId?: string): FormProperty {\n    let newProperty = null;\n    let path = '';\n    let _canonicalPath = '';\n    if (parent) {\n      path += parent.path;\n      if (parent.parent !== null) {\n        path += '/';\n        _canonicalPath += '/';\n      }\n      if (parent.type === 'object') {\n        path += propertyId;\n        _canonicalPath += propertyId;\n      } else if (parent.type === 'array') {\n        path += '*';\n        _canonicalPath += '*';\n      } else {\n        throw 'Instanciation of a FormProperty with an unknown parent type: ' + parent.type;\n      }\n      _canonicalPath = (parent._canonicalPath || parent.path) + _canonicalPath;\n    } else {\n      path = '/';\n      _canonicalPath = '/';\n    }\n\n    if (schema.$ref) {\n      const refSchema = this.schemaValidatorFactory.getSchema(parent.root.schema, schema.$ref);\n      newProperty = this.createProperty(refSchema, parent, path);\n    } else {\n      const type: FieldType = this.isUnionType(schema.type)\n        && this.isValidNullableUnionType(schema.type as TNullableFieldType)\n        && this.isAllowedToUsingNullableUnionTypeBySchemaContext(schema)\n          ? this.extractTypeFromNullableUnionType(schema.type as TNullableFieldType)\n          :  schema.type as FieldType;\n\n      if (PROPERTY_TYPE_MAPPING[type]) {\n        if (type === 'object' || type === 'array') {\n          newProperty = PROPERTY_TYPE_MAPPING[type](\n          this.schemaValidatorFactory, this.validatorRegistry, this.expressionCompilerFactory, schema, parent, path, this, this.logger);\n        } else {\n          newProperty = PROPERTY_TYPE_MAPPING[type](\n          this.schemaValidatorFactory, this.validatorRegistry, this.expressionCompilerFactory, schema, parent, path, this.logger);\n        }\n      } else {\n        throw new TypeError(`Undefined type ${type} (existing: ${Object.keys(PROPERTY_TYPE_MAPPING)})`);\n      }\n    }\n\n    newProperty._propertyBindingRegistry = this.propertyBindingRegistry;\n    newProperty._canonicalPath = _canonicalPath;\n\n    if (newProperty instanceof PropertyGroup) {\n      this.initializeRoot(newProperty);\n    }\n\n    return newProperty;\n  }\n\n  private initializeRoot(rootProperty: PropertyGroup) {\n    rootProperty.reset(null, true);\n    rootProperty._bindVisibility();\n  }\n\n  private isUnionType(unionType: TSchemaPropertyType): boolean {\n    return Array.isArray(unionType) && unionType.length > 1;\n  }\n\n  private isValidNullableUnionType(unionType: TNullableFieldType): boolean {\n    if (!unionType.some(subType => subType === 'null')) {\n      throw new TypeError(`Unsupported union type ${unionType}. Supports only nullable union types, for example [\"string\", \"null\"]`);\n    }\n\n    if (unionType.length !== 2) {\n      throw new TypeError(`Unsupported count of types in nullable union type ${unionType}. Supports only two types one of the which should be \"null\"`);\n    }\n\n    const type = this.extractTypeFromNullableUnionType(unionType);\n\n    if (!type || [FieldType.Object, FieldType.Array].includes(type)) {\n      throw new TypeError(`Unsupported second type ${type} for nullable union. Allowed types are \"${FieldType.Number}\", \"${FieldType.Integer}\", \"${FieldType.Boolean}\", \"${FieldType.String}\"`);\n    }\n\n    return true;\n  }\n\n  private extractTypeFromNullableUnionType(unionType: TNullableFieldType): FieldType | undefined {\n    return unionType.filter(type => type !== 'null')?.[0] as FieldType | undefined;\n  }\n\n  private isAllowedToUsingNullableUnionTypeBySchemaContext(schema: ISchema): boolean {\n    if (!schema.oneOf) {\n      throw new TypeError(`Unsupported using of nullable union type without \"oneOf\" attribute`);\n    }\n\n    return true;\n  }\n}\n","import {isBlank} from './utils';\nimport {Injectable} from '@angular/core';\nimport {ISchema} from './ISchema';\nimport {FieldType} from '../template-schema/field/field';\n\nfunction formatMessage(message, path) {\n  return `Parsing error on ${path}: ${message}`;\n}\n\nfunction schemaError(message, path): void {\n  let mesg = formatMessage(message, path);\n  throw new Error(mesg);\n}\n\nfunction schemaWarning(message, path): void {\n  let mesg = formatMessage(message, path);\n  throw new Error(mesg);\n}\n\n@Injectable()\nexport class SchemaPreprocessor {\n\n  static preprocess(jsonSchema: ISchema, path = '/'): any {\n    jsonSchema = jsonSchema || {};\n    SchemaPreprocessor.normalizeExtensions(jsonSchema);\n    if (jsonSchema.type === 'object') {\n      SchemaPreprocessor.checkProperties(jsonSchema, path);\n      SchemaPreprocessor.checkAndCreateFieldsets(jsonSchema, path);\n    } else if (jsonSchema.type === 'array') {\n      SchemaPreprocessor.checkItems(jsonSchema, path);\n    }\n    SchemaPreprocessor.normalizeWidget(jsonSchema);\n    SchemaPreprocessor.recursiveCheck(jsonSchema, path);\n  }\n\n  private static checkProperties(jsonSchema, path: string) {\n    if (isBlank(jsonSchema.properties)) {\n      jsonSchema.properties = {};\n      schemaWarning('Provided json schema does not contain a \\'properties\\' entry. Output schema will be empty', path);\n    }\n  }\n\n  private static checkAndCreateFieldsets(jsonSchema: any, path: string) {\n    if (jsonSchema.fieldsets === undefined) {\n      if (jsonSchema.order !== undefined) {\n        SchemaPreprocessor.replaceOrderByFieldsets(jsonSchema);\n      } else {\n        SchemaPreprocessor.createFieldsets(jsonSchema);\n      }\n    }\n    SchemaPreprocessor.checkFieldsUsage(jsonSchema, path);\n  }\n\n  private static checkFieldsUsage(jsonSchema: ISchema, path: string) {\n    let fieldsId: string[] = Object.keys(jsonSchema.properties);\n    let usedFields = {};\n    for (let fieldset of jsonSchema.fieldsets) {\n      for (let fieldId of fieldset.fields) {\n        if (usedFields[fieldId] === undefined) {\n          usedFields[fieldId] = [];\n        }\n        usedFields[fieldId].push(fieldset.id);\n      }\n    }\n\n    for (const fieldId of fieldsId) {\n      const isRequired = jsonSchema.required && jsonSchema.required.indexOf(fieldId) > -1;\n      if (isRequired && jsonSchema.properties[fieldId]) {\n        jsonSchema.properties[fieldId].isRequired = true;\n      }\n      if (usedFields.hasOwnProperty(fieldId)) {\n        if (usedFields[fieldId].length > 1) {\n          schemaError(`${fieldId} is referenced by more than one fieldset: ${usedFields[fieldId]}`, path);\n        }\n        delete usedFields[fieldId];\n      } else if (isRequired) {\n        schemaError(`${fieldId} is a required field but it is not referenced as part of a 'order' or a 'fieldset' property`, path);\n      } else {\n        delete jsonSchema[fieldId];\n        schemaWarning(`Removing unreferenced field ${fieldId}`, path);\n      }\n    }\n\n    for (let remainingfieldsId in usedFields) {\n      if (usedFields.hasOwnProperty(remainingfieldsId)) {\n        schemaWarning(`Referencing non-existent field ${remainingfieldsId} in one or more fieldsets`, path);\n      }\n    }\n  }\n\n  private static createFieldsets(jsonSchema: ISchema) {\n    jsonSchema.order = Object.keys(jsonSchema.properties);\n    SchemaPreprocessor.replaceOrderByFieldsets(jsonSchema);\n  }\n\n  private static replaceOrderByFieldsets(jsonSchema: ISchema) {\n    jsonSchema.fieldsets = [{\n      id: 'fieldset-default',\n      title: jsonSchema.title || '',\n      description: jsonSchema.description || '',\n      name: jsonSchema.name || '',\n      fields: jsonSchema.order\n    }];\n    delete jsonSchema.order;\n  }\n\n  private static normalizeWidget(fieldSchema: ISchema) {\n    let widget = fieldSchema.widget;\n    if (widget === undefined) {\n      widget = {'id': fieldSchema.type};\n    } else if (typeof widget === 'string') {\n      widget = {'id': widget};\n    }\n    fieldSchema.widget = widget;\n  }\n\n  private static checkItems(jsonSchema: ISchema, path) {\n    if (jsonSchema.items === undefined) {\n      schemaError('No \\'items\\' property in array', path);\n    }\n  }\n\n  private static recursiveCheck(jsonSchema: ISchema, path: string) {\n    if (jsonSchema.type === FieldType.Object) {\n      for (let fieldId in jsonSchema.properties) {\n        if (jsonSchema.properties.hasOwnProperty(fieldId)) {\n          let fieldSchema = jsonSchema.properties[fieldId];\n          SchemaPreprocessor.preprocess(fieldSchema, path + fieldId + '/');\n        }\n      }\n      if (jsonSchema.hasOwnProperty('definitions')) {\n        for (let fieldId in jsonSchema.definitions) {\n          if (jsonSchema.definitions.hasOwnProperty(fieldId)) {\n            let fieldSchema = jsonSchema.definitions[fieldId];\n            SchemaPreprocessor.removeRecursiveRefProperties(fieldSchema, `#/definitions/${fieldId}`);\n            SchemaPreprocessor.preprocess(fieldSchema, path + fieldId + '/');\n          }\n        }\n      }\n    } else if (jsonSchema.type === 'array') {\n      if (Array.isArray(jsonSchema.items || {})) {\n        for (let i = 0; i < jsonSchema.items.length; i++) {\n          SchemaPreprocessor.preprocess(jsonSchema.items[i], path + '*/');\n        }\n      } else {\n        SchemaPreprocessor.preprocess(jsonSchema.items, path + '*/');\n      }\n      if (jsonSchema.additionalItems) {\n        SchemaPreprocessor.preprocess(jsonSchema.additionalItems, path + '*/');\n      }\n    }\n  }\n\n  private static removeRecursiveRefProperties(jsonSchema: ISchema, definitionPath) {\n    // to avoid infinite loop\n    if (jsonSchema.type === FieldType.Object) {\n      for (let fieldId in jsonSchema.properties) {\n        if (jsonSchema.properties.hasOwnProperty(fieldId)) {\n          if (jsonSchema.properties[fieldId].$ref\n            && jsonSchema.properties[fieldId].$ref === definitionPath) {\n            delete jsonSchema.properties[fieldId];\n          } else if (jsonSchema.properties[fieldId].type === 'object') {\n            SchemaPreprocessor.removeRecursiveRefProperties(jsonSchema.properties[fieldId], definitionPath);\n          }\n        }\n      }\n    }\n  }\n  \n  /**\n   * Enables alias names for JSON schema extensions.\n   *\n   * Copies the value of each alias JSON schema property\n   * to the JSON schema property of ngx-schema-form.\n   *\n   * @param schema JSON schema to enable alias names.\n   */\n  private static normalizeExtensions(schema: ISchema): void {\n    const extensions = [\n        { name: \"fieldsets\", regex: /^x-?field-?sets$/i },\n        { name: \"widget\",    regex: /^x-?widget$/i },\n        { name: \"visibleIf\", regex: /^x-?visible-?if$/i }\n    ];\n    const keys = Object.keys(schema);\n    for (let i = 0; i < keys.length; ++i) {\n      let k = keys[i];\n      let e = extensions.find(e => !!k.match(e.regex));\n      if (e) {\n        let v = schema[k];\n        let copy = JSON.parse(JSON.stringify(v));\n        schema[e.name] = copy;\n      }\n    }\n  }\n}\n\n","export function isPresent(o) {\n  return o !== null && o !== undefined;\n}\n\nexport function isBlank(o) {\n  return o === null || o === undefined;\n}\n","import { Validator } from './validator';\nimport { Injectable } from \"@angular/core\";\n\n@Injectable()\nexport class ValidatorRegistry {\n  private validators: Validator[] = [];\n\n  register(path: string, validator: Validator) {\n    this.validators[path] = validator;\n  }\n\n  get(path: string): Validator {\n    return this.validators[path];\n  }\n\n  clear() {\n    this.validators = [];\n  }\n}\n","import {Binding} from './binding';\nimport { Injectable } from \"@angular/core\";\n\n@Injectable()\nexport class BindingRegistry {\n  bindings: Binding[] = [];\n\n  clear() {\n    this.bindings = [];\n  }\n\n  register(path: string, binding: Binding | Binding[]) {\n    this.bindings[path] = [].concat(binding);\n  }\n\n  get(path: string): Binding[] {\n    return this.bindings[path];\n  }\n}\n","import ZSchema from 'z-schema';\nimport {Injectable} from '@angular/core';\nimport {ISchema} from './model/ISchema';\nimport {FieldType} from './template-schema/field/field';\n\nexport abstract class SchemaValidatorFactory {\n  abstract createValidatorFn(schema): (value: any) => any;\n\n  abstract getSchema(schema, ref): any;\n\n  /**\n   * Override this method to reset the schema validator instance.<br/>\n   * This may be required since some schema validators keep a deep copy<br/>\n   * of your schemas and changes at runtime are not recognized by the schema validator.<br/>\n   * In this method you should either re-instantiate the schema validator or\n   * clear its cache.<br/>\n   * Example of re-instantiating schema validator\n   * <code>\n   *     reset(){\n   *         this.zschema = new ZSchema({})\n   *     }\n   * </code>\n   * <br/>\n   * Since this method it self does nothing there is <br/>\n   * no need to call the <code>super.reset()</code>\n   */\n  reset() {\n\n  }\n}\n\n@Injectable()\nexport class ZSchemaValidatorFactory extends SchemaValidatorFactory {\n\n  protected zschema;\n\n  constructor() {\n    super();\n    this.createSchemaValidator();\n  }\n\n  private createSchemaValidator() {\n    this.zschema =  new ZSchema({\n      breakOnFirstError: false\n    });\n  }\n\n  reset() {\n    this.createSchemaValidator();\n  }\n\n  createValidatorFn(schema: ISchema) {\n    return (value): { [key: string]: boolean } => {\n\n      if (schema.type === FieldType.Number || schema.type === FieldType.Integer) {\n        value = +value;\n      }\n\n      this.zschema.validate(value, schema);\n      // tslint:disable-next-line:prefer-const\n      let err = this.zschema.getLastErrors();\n\n      this.denormalizeRequiredPropertyPaths(err);\n\n      return err || null;\n    };\n  }\n\n  getSchema(schema: any, ref: string) {\n    // check definitions are valid\n    const isValid = this.zschema.compileSchema(schema);\n    if (isValid) {\n      return this.getDefinition(schema, ref);\n    } else {\n      throw this.zschema.getLastError();\n    }\n  }\n\n  private denormalizeRequiredPropertyPaths(err: any[]) {\n    if (err && err.length) {\n      err = err.map(error => {\n        if (error.path === '#/' && error.code === 'OBJECT_MISSING_REQUIRED_PROPERTY') {\n          error.path = `${error.path}${error.params[0]}`;\n        }\n        return error;\n      });\n    }\n  }\n\n  private getDefinition(schema: any, ref: string) {\n    let foundSchema = schema;\n    ref.split('/').slice(1).forEach(ptr => {\n      if (ptr) {\n        foundSchema = foundSchema[ptr];\n      }\n    });\n    return foundSchema;\n  }\n}\n\n","export class WidgetRegistry {\n\n  private widgets: { [type: string]: any } = {};\n\n  private defaultWidget: any;\n\n  constructor() { }\n\n  setDefaultWidget(widget: any) {\n    this.defaultWidget = widget;\n  }\n\n  getDefaultWidget() {\n    return this.defaultWidget;\n  }\n\n  hasWidget(type: string) {\n    return this.widgets.hasOwnProperty(type);\n  }\n\n  register(type: string, widget: any) {\n    this.widgets[type] = widget;\n  }\n\n  getWidgetType(type: string): any {\n    if (this.hasWidget(type)) {\n      return this.widgets[type];\n    }\n    return this.defaultWidget;\n  }\n}\n","import {\n  ViewContainerRef,\n  ComponentRef,\n  ComponentFactoryResolver,\n  Injectable\n} from '@angular/core';\n\nimport { WidgetRegistry } from './widgetregistry';\n\n@Injectable()\nexport class WidgetFactory {\n\n  private resolver: ComponentFactoryResolver;\n  private registry: WidgetRegistry;\n\n  constructor(registry: WidgetRegistry, resolver: ComponentFactoryResolver) {\n    this.registry = registry;\n    this.resolver = resolver;\n  }\n\n  createWidget(container: ViewContainerRef, type: string): ComponentRef<any> {\n    let componentClass = this.registry.getWidgetType(type);\n\n    let componentFactory = this.resolver.resolveComponentFactory(componentClass);\n    return container.createComponent(componentFactory);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs';\n\n@Injectable()\nexport class TerminatorService {\n  public onDestroy: Subject<boolean>;\n\n  constructor() {\n    this.onDestroy = new Subject();\n  }\n\n  destroy() {\n    this.onDestroy.next(true);\n  }\n}\n","import { Injectable } from \"@angular/core\";\n/**\n * General purpose propery binding registry\n */\n@Injectable()\nexport class PropertyBindingRegistry {\n\n  private bindings: { [key: string]: PropertyBindings } = {};\n\n  getPropertyBindings(type: PropertyBindingTypes): PropertyBindings {\n    this.bindings[type] = this.bindings[type] || new PropertyBindings();\n    return this.bindings[type];\n  }\n\n  getPropertyBindingsVisibility() {\n    return this.getPropertyBindings(PropertyBindingTypes.visibility);\n  }\n}\n\n/**\n * Defines the types of supported property bindings.<br/>\n * For now only <code>visibility</code> is supported.<br/>\n */\nexport enum PropertyBindingTypes {\n  visibility\n}\n\n/**\n * Storage that holds all bindings that are property paths related.<br/>\n */\nexport class PropertyBindings {\n  sourcesIndex: SimplePropertyIndexer = new SimplePropertyIndexer();\n  dependenciesIndex: SimplePropertyIndexer = new SimplePropertyIndexer();\n\n  add(dependencyPath: string, sourcePropertyPath: string) {\n    this.sourcesIndex.store(sourcePropertyPath, dependencyPath);\n    this.dependenciesIndex.store(dependencyPath, sourcePropertyPath);\n  }\n\n  findByDependencyPath(dependencyPath: string): string[] {\n    const result = this.dependenciesIndex.find(dependencyPath);\n    result.results = result.results || [];\n    let values = [];\n    for (const res of result.results) {\n      values = values.concat(Object.keys(res.value));\n    }\n    return result.found ? values : [];\n  }\n\n  getBySourcePropertyPath(sourcePropertyPath: string): string[] {\n    const result = this.sourcesIndex.find(sourcePropertyPath);\n    result.results = result.results || [];\n    let values = [];\n    for (const res of result.results) {\n      values = values.concat(Object.keys(res.value));\n    }\n    return result.found ? values : [];\n  }\n\n  createPathIndex(path: string): string[] {\n    return path.split('/');\n  }\n}\n\n/**\n * Simple indexer to store property paths\n */\nexport class SimplePropertyIndexer {\n\n  static MARKER = '$____value';\n  index: object = {};\n  findOnlyWithValue = true;\n\n  private _createPathIndex(path: string) {\n    return path\n      .replace(new RegExp('//', 'g'), '/')\n      .replace(new RegExp('^/', 'g'), '')\n      .split('/').filter(item => item);\n  }\n\n  store(propertyPath: string, value?: any) {\n    this._storeIndex(this._createPathIndex(propertyPath), value);\n  }\n\n  private _storeIndex(pathIndex: string[], value?: string) {\n    let indexPos = this.index;\n    for (const key of pathIndex) {\n      indexPos[key] = indexPos[key] || {};\n      indexPos = indexPos[key];\n    }\n    if (indexPos && value) {\n      indexPos[SimplePropertyIndexer.MARKER] = indexPos[SimplePropertyIndexer.MARKER] || {};\n      indexPos[SimplePropertyIndexer.MARKER][value] = value;\n    }\n  }\n\n  /**\n   * Find path in index.<br/>\n   * Will find path like:<br/>\n   * <ul>\n   *     <li>/property/0/prop</li>\n   *     <li>/property/0/prop/2/test</li>\n   *     <li>/property/0/prop/&#42;/test</li>\n   *     <li>/property/&#42;/prop/1/test</li>\n   *     <li>/property/&#42;/prop/&#42;/test</li>\n   *     <li>/property/1/prop/&#42;/test</li>\n   *  </ul>\n   * @param path\n   */\n  find(path: string): IndexerResult {\n    return this._findInIndex(this._createPathIndex(path));\n  }\n\n  _findInIndex(path: string[]): IndexerResult {\n    const ixRes: IndexerResult = {target: path, found: false, results: []};\n    this.__findIndex(ixRes, path, this.index, []);\n    return ixRes;\n  }\n\n  __findIndex(indexerResults: IndexerResult, path: string[], index: object, parent?: string[]) {\n\n    const p = parent || [];\n    const segment = path[0];\n    const wild = ('*' === segment) ? Object.keys(index) : [];\n    const _keys = ((Array.isArray(segment) ? segment : [segment]) as string[]).concat(wild);\n    const keys = _keys.filter((item, pos) => '*' !== item && _keys.indexOf(item) === pos); // remove duplicates\n\n    if (index['*']) {\n      keys.push('*');\n    }\n\n    let paths = [];\n    for (const key of keys) {\n      const restPath = path.slice(1);\n      const restIndex = index[key];\n      const restParent = p.concat(key);\n\n      if (path.length === 1) {// collect only the full paths\n        if (!this.findOnlyWithValue || (restIndex && restIndex[SimplePropertyIndexer.MARKER])) {\n          indexerResults.results = indexerResults.results || [];\n          indexerResults.results.push({\n            path: restParent,\n            value: restIndex[SimplePropertyIndexer.MARKER]\n          });\n          paths.push(restParent);\n          indexerResults.found = indexerResults.results.length > 0;\n        }\n      }\n\n      if (!restPath || !restPath.length || !restIndex) {\n        break;\n      }\n      const restPaths = this.__findIndex(indexerResults, restPath, restIndex, restParent);\n\n      paths = paths.concat(restPaths);\n    }\n    return paths;\n  }\n\n}\n\nexport interface IndexerResult {\n  /**\n   * The path originally searched for\n   */\n  target: string[];\n  /**\n   * Flag for the status of found or not found.<br/>\n   * Usually <code>results</code> will be empty if no matches found.\n   */\n  found: boolean;\n  /**\n   * The result path and values from the index search.<br/>\n   * Usually <code>results</code> will be empty if no matches found.\n   */\n  results: {\n    /**\n     * The path that matched the <code>target</code>\n     * separated in segments\n     */\n    path: string[],\n    /**\n     * The value stored at the <code>path</code>\n     */\n    value: any\n  }[];\n}\n","export abstract class ExpressionCompilerFactory {\n    public abstract createExpressionCompiler(): ExpressionCompiler;\n    public abstract createExpressionCompilerVisibilityIf(): ExpressionCompilerVisibilityIf;\n}\n\nexport interface ExpressionCompiler {\n    evaluate(expression: string, context: object): any;\n}\n\nexport interface ExpressionCompilerVisibilityIf {\n    evaluate(expression: string, context: ExpressionContextVisibilitIf): any;\n}\n/**\n * UseCase:<br/>\n * When evaluating the expression of a <code>visibilityIf</code> condition\n * an instance of this definition will be passed as context.<br/>\n * This will give access to the source and target <code>FormProperty</code>.\n */\nexport interface ExpressionContextVisibilitIf {\n    /**\n     * The source property which has the <code>visibilityIf</code> defined\n     */\n    source: FormProperty\n    /**\n     * The target property given with the <code>visibilityIf</code>\n     * <em>path</em> property\n     */\n    target: FormProperty\n}\n\n\nimport * as JEXL from 'jexl';\nimport { FormProperty } from './model';\n\nexport class JEXLExpressionCompilerFactory extends ExpressionCompilerFactory {\n    public createExpressionCompiler(): ExpressionCompiler {\n        return new JEXLExpressionCompiler();\n    }\n\n    public createExpressionCompilerVisibilityIf(): ExpressionCompilerVisibilityIf {\n        return new JEXLExpressionCompilerVisibiltyIf();\n    }\n}\n\nexport class JEXLExpressionCompiler implements ExpressionCompiler {\n    evaluate(expression: string, context: object = {}): any {\n        return new JEXL.Jexl().evalSync(expression, context)\n    }\n}\n\nexport class JEXLExpressionCompilerVisibiltyIf implements ExpressionCompilerVisibilityIf {\n    evaluate(expression: string, context: ExpressionContextVisibilitIf = { source: {} as FormProperty, target: {} as FormProperty }): any {\n        return new JEXL.Jexl().evalSync(expression, context)\n    }\n}\n","import { InjectionToken, Inject, Injectable, Optional } from \"@angular/core\";\n\nexport const LOG_LEVEL = new InjectionToken<LogLevel>('Logging level');\n\n/**\n * Represents the different logging levels of the `console` output.\n */\nexport const enum LogLevel {\n    log,\n    warn,\n    error,\n    off,\n    all\n}\n\nexport abstract class LogService {\n    public logLevel = LogLevel.off;\n    constructor(@Optional() @Inject(LOG_LEVEL) public level: any /* should be of type `LogLevel` but AOT fails with : 'Error encountered in metadata generated for exported symbol 'DefaultLogService':\"Could not resolve type LogLevel.\" */) {\n        this.logLevel = level as LogLevel\n    }\n    /**\n     * Equals `console.warn`\n     * @param message \n     * @param optionalParams \n     */\n    public abstract warn(message?: any, ...optionalParams: any[]): void\n    /**\n     * Equals `console.error`\n     * @param message \n     * @param optionalParams \n     */\n    public abstract error(message?: any, ...optionalParams: any[]): void\n    /**\n     * Equals `console.log`\n     * @param message \n     * @param optionalParams \n     */\n    public abstract log(message?: any, ...optionalParams: any[]): void\n\n    isWarnEnabled() {\n        return LogLevel.all === this.logLevel || LogLevel.warn === this.logLevel\n    }\n\n    isErrorEnabled() {\n        return LogLevel.all === this.logLevel || LogLevel.error === this.logLevel\n    }\n\n    isLogEnabled() {\n        return LogLevel.all === this.logLevel || LogLevel.log === this.logLevel\n    }\n}\n\n/**\n * Very simple abstraction of logging\n */\n@Injectable()\nexport class DefaultLogService extends LogService {\n\n    constructor(@Optional() @Inject(LOG_LEVEL) public logLevel: any /* should be of type `LogLevel` but AOT fails with : 'Error encountered in metadata generated for exported symbol 'DefaultLogService':\"Could not resolve type LogLevel.\" */) {\n        super(logLevel)\n        this.logLevel = logLevel as LogLevel\n    }\n    warn = (!this.isWarnEnabled() ? () => { } : console.warn)\n    error = (!this.isErrorEnabled() ? () => { } : console.error)\n    log = (!this.isLogEnabled() ? () => { } : console.log)\n}","import {\n  ChangeDetectorRef,\n  Component,\n  OnChanges,\n  EventEmitter,\n  Input,\n  Output,\n  SimpleChanges\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\n\nimport {Action} from './model/action';\nimport {ActionRegistry} from './model/actionregistry';\nimport {FormProperty} from './model/formproperty';\nimport {FormPropertyFactory} from './model/formpropertyfactory';\nimport {SchemaPreprocessor} from './model/schemapreprocessor';\nimport {ValidatorRegistry} from './model/validatorregistry';\nimport {Validator} from './model/validator';\nimport {Binding} from './model/binding';\nimport {BindingRegistry} from './model/bindingregistry';\n\nimport {SchemaValidatorFactory} from './schemavalidatorfactory';\nimport {WidgetFactory} from './widgetfactory';\nimport {TerminatorService} from './terminator.service';\nimport {PropertyBindingRegistry} from './property-binding-registry';\nimport { ExpressionCompilerFactory } from './expression-compiler-factory';\nimport {ISchema} from './model/ISchema';\nimport { LogService } from './log.service';\n\nexport function useFactory(schemaValidatorFactory, validatorRegistry, propertyBindingRegistry, expressionCompilerFactory, logService) {\n  return new FormPropertyFactory(schemaValidatorFactory, validatorRegistry, propertyBindingRegistry, expressionCompilerFactory, logService);\n}\n\n@Component({\n  selector: 'sf-form',\n  template: `\n    <form *ngIf=\"rootProperty\" [attr.name]=\"rootProperty.rootName\" [attr.id]=\"rootProperty.rootName\">\n      <sf-form-element [formProperty]=\"rootProperty\"></sf-form-element>\n    </form>`,\n  providers: [\n    ActionRegistry,\n    ValidatorRegistry,\n    PropertyBindingRegistry,\n    BindingRegistry,\n    SchemaPreprocessor,\n    WidgetFactory,\n    {\n      provide: FormPropertyFactory,\n      useFactory: useFactory,\n      deps: [SchemaValidatorFactory, ValidatorRegistry, PropertyBindingRegistry, ExpressionCompilerFactory, LogService]\n    },\n    TerminatorService,\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: FormComponent,\n      multi: true\n    }\n  ]\n})\nexport class FormComponent implements OnChanges, ControlValueAccessor {\n\n  @Input() schema: ISchema | null = null;\n\n  @Input() model: any;\n\n  @Input() actions: { [actionId: string]: Action } = {};\n\n  @Input() validators: { [path: string]: Validator } = {};\n\n  @Input() bindings: { [path: string]: Binding } = {};\n\n  @Output() onChange = new EventEmitter<{ value: any }>();\n\n  @Output() modelChange = new EventEmitter<any>();\n\n  @Output() isValid = new EventEmitter<boolean>();\n\n  @Output() onErrorChange = new EventEmitter<{ value: any[] }>();\n\n  @Output() onErrorsChange = new EventEmitter<{value: any}>();\n\n  rootProperty: FormProperty = null;\n\n  private onChangeCallback: any;\n\n  constructor(\n    private formPropertyFactory: FormPropertyFactory,\n    private actionRegistry: ActionRegistry,\n    private validatorRegistry: ValidatorRegistry,\n    private bindingRegistry: BindingRegistry,\n    private cdr: ChangeDetectorRef,\n    private terminator: TerminatorService\n  ) { }\n\n  writeValue(obj: any) {\n    if (this.rootProperty) {\n      this.rootProperty.reset(obj, false);\n    }\n  }\n\n  registerOnChange(fn: any) {\n    this.onChangeCallback = fn;\n    if (this.rootProperty) {\n      this.rootProperty.valueChanges.subscribe(\n        this.onValueChanges.bind(this)\n      );\n    }\n  }\n\n  // TODO implement\n  registerOnTouched(fn: any) {\n  }\n\n  // TODO implement\n  // setDisabledState(isDisabled: boolean)?: void\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.validators) {\n      this.setValidators();\n    }\n\n    if (changes.actions) {\n      this.setActions();\n    }\n\n    if (changes.bindings) {\n      this.setBindings();\n    }\n\n    if (this.schema && !this.schema.type) {\n      this.schema.type = 'object';\n    }\n\n    if (this.schema && changes.schema) {\n      if (!changes.schema.firstChange) {\n        this.terminator.destroy();\n      }\n\n      SchemaPreprocessor.preprocess(this.schema);\n      this.rootProperty = this.formPropertyFactory.createProperty(this.schema);\n      if (this.model) {\n        // this.rootProperty.reset(this.model, false);\n      }\n\n      this.rootProperty.valueChanges.subscribe(\n        this.onValueChanges.bind(this)\n      );\n\n      this.rootProperty.errorsChanges.subscribe(value => {\n        this.onErrorChange.emit({value: value});\n        this.isValid.emit(!(value && value.length));\n      });\n\n    }\n\n    if (this.schema && (changes.model || changes.schema )) {\n      this.rootProperty.reset(this.model, false);\n      this.cdr.detectChanges();\n    }\n\n  }\n\n  private setValidators() {\n    this.validatorRegistry.clear();\n    if (this.validators) {\n      for (const validatorId in this.validators) {\n        if (this.validators.hasOwnProperty(validatorId)) {\n          this.validatorRegistry.register(validatorId, this.validators[validatorId]);\n        }\n      }\n    }\n  }\n\n  private setActions() {\n    this.actionRegistry.clear();\n    if (this.actions) {\n      for (const actionId in this.actions) {\n        if (this.actions.hasOwnProperty(actionId)) {\n          this.actionRegistry.register(actionId, this.actions[actionId]);\n        }\n      }\n    }\n  }\n\n  private setBindings() {\n    this.bindingRegistry.clear();\n    if (this.bindings) {\n      for (const bindingPath in this.bindings) {\n        if (this.bindings.hasOwnProperty(bindingPath)) {\n          this.bindingRegistry.register(bindingPath, this.bindings[bindingPath]);\n        }\n      }\n    }\n  }\n\n  public reset() {\n    this.rootProperty.reset(null, true);\n  }\n\n  private setModel(value: any) {\n    if (this.model) {\n      Object.assign(this.model, value);\n    } else {\n      this.model = value;\n    }\n  }\n\n  private onValueChanges(value) {\n    if (this.onChangeCallback) {\n      this.setModel(value);\n      this.onChangeCallback(value);\n    }\n\n    // two way binding is used\n    if (this.modelChange.observers.length > 0) {\n      if (!this.onChangeCallback) {\n        this.setModel(value);\n      }\n    }\n    this.onChange.emit({value: value});\n  }\n}\n","import {\n  Component, ElementRef,\n  Input, OnDestroy,\n  OnInit, Renderer2\n} from '@angular/core';\n\nimport {\n  FormControl\n} from '@angular/forms';\n\nimport {Widget} from './widget';\n\nimport {ActionRegistry} from './model/actionregistry';\nimport {FormProperty} from './model/formproperty';\nimport {BindingRegistry} from './model/bindingregistry';\nimport {Binding} from './model/binding';\nimport { LogService } from './log.service';\n\n@Component({\n  selector: 'sf-form-element',\n  template: `\n    <div *ngIf=\"formProperty.visible\"\n         [class.has-error]=\"!control.valid\"\n         [class.has-success]=\"control.valid\">\n      <sf-widget-chooser\n        (widgetInstanciated)=\"onWidgetInstanciated($event)\"\n        [widgetInfo]=\"formProperty.schema.widget\">\n      </sf-widget-chooser>\n      <sf-form-element-action *ngFor=\"let button of buttons\" [button]=\"button\" [formProperty]=\"formProperty\"></sf-form-element-action>\n    </div>`\n})\nexport class FormElementComponent implements OnInit, OnDestroy {\n\n  private static counter = 0;\n\n  @Input() formProperty: FormProperty;\n  control: FormControl = new FormControl('', () => null);\n\n  widget: Widget<any> = null;\n\n  buttons = [];\n\n  unlisten = [];\n\n  constructor(private actionRegistry: ActionRegistry,\n              private bindingRegistry: BindingRegistry,\n              private renderer: Renderer2,\n              private elementRef: ElementRef,\n              private logger: LogService) {\n  }\n\n  ngOnInit() {\n    this.parseButtons();\n    this.setupBindings();\n  }\n\n  private setupBindings() {\n    const bindings: Binding[] = this.bindingRegistry.get(this.formProperty.path);\n    if ((bindings || []).length) {\n      bindings.forEach((binding) => {\n        for (const eventId in binding) {\n          this.createBinding(eventId, binding[eventId]);\n        }\n      });\n    }\n  }\n\n  private createBinding(eventId, listeners) {\n    this.unlisten.push(this.renderer.listen(this.elementRef.nativeElement,\n      eventId,\n      (event) => {\n        const _listeners = Array.isArray(listeners) ? listeners : [listeners]\n        for (const _listener of _listeners) {\n          if (_listener instanceof Function) {\n            try { _listener(event, this.formProperty); } catch (e) { this.logger.error(`Error calling bindings event listener for '${eventId}'`, e) }\n          } else {\n            this.logger.warn('Calling non function handler for eventId ' + eventId + ' for path ' + this.formProperty.path);\n          }\n        }\n      }));\n  }\n\n  private parseButtons() {\n    if (this.formProperty.schema.buttons !== undefined) {\n      this.buttons = this.formProperty.schema.buttons;\n\n      for (let button of this.buttons) {\n        this.createButtonCallback(button);\n      }\n    }\n  }\n\n  private createButtonCallback(button) {\n    button.action = (e) => {\n      let action;\n      if (button.id && (action = this.actionRegistry.get(button.id))) {\n        if (action) {\n          action(this.formProperty, button.parameters);\n        }\n      }\n      e.preventDefault();\n    };\n  }\n\n  onWidgetInstanciated(widget: Widget<any>) {\n    this.widget = widget;\n    let id = this.formProperty.canonicalPathNotation || 'field' + (FormElementComponent.counter++);\n    if (this.formProperty.root.rootName) {\n      id = `${this.formProperty.root.rootName}:${id}`;\n    }\n\n    this.widget.formProperty = this.formProperty;\n    this.widget.schema = this.formProperty.schema;\n    this.widget.name = id;\n    this.widget.id = id;\n    this.widget.control = this.control;\n  }\n\n  ngOnDestroy(): void {\n    if (this.unlisten) {\n      this.unlisten.forEach((item) => {\n        item();\n      });\n    }\n  }\n\n}\n","import {\n  Component,\n  ComponentRef,\n  Input,\n  OnChanges,\n  ViewChild,\n  ViewContainerRef,\n  OnInit,\n  OnDestroy\n} from \"@angular/core\";\nimport {Subscription} from 'rxjs';\nimport {WidgetFactory} from \"./widgetfactory\";\nimport {TerminatorService} from \"./terminator.service\";\n\n@Component({\n  selector: 'sf-form-element-action',\n  template: '<ng-template #target></ng-template>'\n})\nexport class FormElementComponentAction implements OnInit, OnChanges, OnDestroy {\n\n  @Input()\n  button: any;\n\n  @Input()\n  formProperty: any;\n\n  @ViewChild('target', { read: ViewContainerRef, static: true }) container: ViewContainerRef;\n\n  private ref: ComponentRef<any>;\n  private subs: Subscription;\n\n  constructor(private widgetFactory: WidgetFactory = null,\n              private terminator: TerminatorService) {\n  }\n\n  ngOnInit() {\n    this.subs = this.terminator.onDestroy.subscribe(destroy => {\n      if (destroy) {\n        this.ref.destroy();\n      }\n    });\n  }\n\n  ngOnChanges() {\n    this.ref = this.widgetFactory.createWidget(this.container, this.button.widget || 'button');\n    this.ref.instance.button = this.button;\n    this.ref.instance.formProperty = this.formProperty;\n  }\n\n  ngOnDestroy() {\n    this.subs.unsubscribe();\n  }\n}\n","import {\n  Component,\n  ComponentRef,\n  ChangeDetectorRef,\n  EventEmitter,\n  Input,\n  OnChanges,\n  Output,\n  ViewChild,\n  ViewContainerRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { TerminatorService } from './terminator.service';\nimport { WidgetFactory } from './widgetfactory';\nimport { Subscription } from 'rxjs';\n\n\n@Component({\n  selector: 'sf-widget-chooser',\n  template: `<div #target></div>`,\n})\nexport class WidgetChooserComponent implements OnInit, OnChanges, OnDestroy {\n\n  @Input() widgetInfo: any;\n\n  @Output() widgetInstanciated = new EventEmitter<any>();\n\n  @ViewChild('target', { read: ViewContainerRef, static: true }) container: ViewContainerRef;\n\n  private widgetInstance: any;\n  private ref: ComponentRef<any>;\n  private subs: Subscription;\n\n  constructor(\n    private widgetFactory: WidgetFactory = null,\n    private cdr: ChangeDetectorRef,\n    private terminator: TerminatorService,\n  ) { }\n\n  ngOnInit() {\n    this.subs = this.terminator.onDestroy.subscribe(destroy => {\n      if (destroy) {\n        this.ref.destroy();\n      }\n    });\n  }\n\n  ngOnChanges() {\n    this.ref = this.widgetFactory.createWidget(this.container, this.widgetInfo.id);\n    this.widgetInstanciated.emit(this.ref.instance);\n    this.widgetInstance = this.ref.instance;\n    this.cdr.detectChanges();\n  }\n\n  ngOnDestroy() {\n    this.subs.unsubscribe();\n  }\n}\n","import {FormProperty} from './formproperty';\n\nexport abstract class AtomicProperty extends FormProperty {\n\n  setValue(value, onlySelf = false) {\n    this._value = value;\n    this.updateValueAndValidity(onlySelf, true);\n  }\n\n  reset(value: any = null, onlySelf = true) {\n    this.resetValue(value);\n    this.updateValueAndValidity(onlySelf, true);\n  }\n\n  resetValue(value: any): any {\n    if (value === null) {\n      if (this.schema.default !== undefined) {\n        value = this.schema.default;\n      } else {\n        value = this.fallbackValue();\n      }\n    }\n    this._value = value;\n  }\n\n  public _hasValue(): boolean {\n    return this.fallbackValue() !== this.value;\n  }\n\n  abstract fallbackValue(): any;\n\n  public _updateValue() {\n  }\n}\n","import { PROPERTY_TYPE_MAPPING } from './typemapping';\nimport {PropertyGroup} from './formproperty';\nimport {FormPropertyFactory} from './formpropertyfactory';\nimport {SchemaValidatorFactory} from '../schemavalidatorfactory';\nimport {ValidatorRegistry} from './validatorregistry';\nimport { ExpressionCompilerFactory } from '../expression-compiler-factory';\nimport {ISchema} from './ISchema';\nimport { LogService } from '../log.service';\n\nexport class ObjectProperty extends PropertyGroup {\n\n  private propertiesId: string[] = [];\n\n  constructor(private formPropertyFactory: FormPropertyFactory,\n              schemaValidatorFactory: SchemaValidatorFactory,\n              validatorRegistry: ValidatorRegistry,\n              expressionCompilerFactory: ExpressionCompilerFactory,\n              schema: ISchema,\n              parent: PropertyGroup,\n              path: string,\n              logger: LogService) {\n    super(schemaValidatorFactory, validatorRegistry, expressionCompilerFactory, schema, parent, path, logger);\n    this.createProperties();\n  }\n\n  setValue(value: any, onlySelf: boolean) {\n    for (const propertyId in value) {\n      if (value.hasOwnProperty(propertyId)) {\n        this.properties[propertyId].setValue(value[propertyId], true);\n      }\n    }\n    this.updateValueAndValidity(onlySelf, true);\n  }\n\n  reset(value: any, onlySelf = true) {\n    value = value || this.schema.default || {};\n    this.resetProperties(value);\n    this.updateValueAndValidity(onlySelf, true);\n  }\n\n  resetProperties(value: any) {\n    for (const propertyId in this.schema.properties) {\n      if (this.schema.properties.hasOwnProperty(propertyId)) {\n        this.properties[propertyId].reset(value[propertyId], true);\n      }\n    }\n  }\n\n  createProperties() {\n    this.properties = {};\n    this.propertiesId = [];\n    for (const propertyId in this.schema.properties) {\n      if (this.schema.properties.hasOwnProperty(propertyId)) {\n        const propertySchema = this.schema.properties[propertyId];\n        this.properties[propertyId] = this.formPropertyFactory.createProperty(propertySchema, this, propertyId);\n        this.propertiesId.push(propertyId);\n      }\n    }\n  }\n\n  public _hasValue(): boolean {\n    return !!Object.keys(this.value).length;\n  }\n\n  public _updateValue() {\n    this.reduceValue();\n  }\n\n  public _runValidation() {\n    super._runValidation();\n\n    if (this._errors) {\n      this._errors.forEach(error => {\n        const prop = this.searchProperty(error.path.slice(1));\n        if (prop) {\n          prop.extendErrors(error);\n        }\n      });\n    }\n  }\n\n  private reduceValue(): void {\n    const value = {};\n    this.forEachChild((property, propertyId: string) => {\n      if (property.visible && property._hasValue()) {\n        value[propertyId] = property.value;\n      }\n    });\n    this._value = value;\n  }\n}\n\nPROPERTY_TYPE_MAPPING.object = (\n    schemaValidatorFactory: SchemaValidatorFactory,\n    validatorRegistry: ValidatorRegistry,\n    expressionCompilerFactory: ExpressionCompilerFactory,\n    schema: ISchema,\n    parent: PropertyGroup,\n    path: string,\n    formPropertyFactory: FormPropertyFactory,\n    logger: LogService\n) => {\n    return new ObjectProperty(\n        formPropertyFactory, schemaValidatorFactory, validatorRegistry, expressionCompilerFactory, schema, parent, path, logger);\n};\n","import {FormProperty, PropertyGroup} from './formproperty';\nimport {FormPropertyFactory} from './formpropertyfactory';\nimport { PROPERTY_TYPE_MAPPING } from './typemapping';\nimport {SchemaValidatorFactory} from '../schemavalidatorfactory';\nimport {ValidatorRegistry} from './validatorregistry';\nimport { ExpressionCompilerFactory } from '../expression-compiler-factory';\nimport {ISchema} from './ISchema';\nimport { LogService } from '../log.service';\n\nexport class ArrayProperty extends PropertyGroup {\n\n  constructor(private formPropertyFactory: FormPropertyFactory,\n              schemaValidatorFactory: SchemaValidatorFactory,\n              validatorRegistry: ValidatorRegistry,\n              expressionCompilerFactory: ExpressionCompilerFactory,\n              schema: ISchema,\n              parent: PropertyGroup,\n              path: string,\n              logger: LogService) {\n    super(schemaValidatorFactory, validatorRegistry, expressionCompilerFactory, schema, parent, path, logger);\n  }\n\n  addItem(value: any = null): FormProperty {\n    let newProperty = this.addProperty();\n    newProperty.reset(value, false);\n    return newProperty;\n  }\n\n  private addProperty() {\n    let itemSchema = this.schema.items\n    if (Array.isArray(this.schema.items)) {\n      const itemSchemas = this.schema.items as object[]\n      if (itemSchemas.length > (<FormProperty[]>this.properties).length) {\n        itemSchema = itemSchema[(<FormProperty[]>this.properties).length]\n      } else if (this.schema.additionalItems) {\n        itemSchema = this.schema.additionalItems\n      } else {\n        // souldn't add new items since schema is undefined for the item at its position\n        return null\n      }\n    }\n    let newProperty = this.formPropertyFactory.createProperty(itemSchema, this);\n    (<FormProperty[]>this.properties).push(newProperty);\n    return newProperty;\n  }\n\n  removeItem(item: FormProperty) {\n    this.properties = (<FormProperty[]>this.properties).filter(i => i !== item);\n    this.updateValueAndValidity(false, true);\n  }\n\n  setValue(value: any, onlySelf: boolean) {\n    this.createProperties();\n    this.resetProperties(value);\n    this.updateValueAndValidity(onlySelf, true);\n  }\n\n  public _hasValue(): boolean {\n    return true;\n  }\n\n  public _updateValue() {\n    this.reduceValue();\n  }\n\n  private reduceValue(): void {\n    const value = [];\n    this.forEachChild((property, _) => {\n      if (property.visible && property._hasValue()) {\n        value.push(property.value);\n      }\n    });\n    this._value = value;\n  }\n\n  reset(value: any, onlySelf = true) {\n    value = value || this.schema.default || [];\n    this.properties = [];\n    this.resetProperties(value);\n    this.updateValueAndValidity(onlySelf, true);\n  }\n\n  private createProperties() {\n    this.properties = [];\n  }\n\n\n  private resetProperties(value: any) {\n    for (let idx in value) {\n      if (value.hasOwnProperty(idx)) {\n        let property = this.addProperty();\n        property.reset(value[idx], true);\n      }\n    }\n  }\n}\n\nPROPERTY_TYPE_MAPPING.array = (\n    schemaValidatorFactory: SchemaValidatorFactory,\n    validatorRegistry: ValidatorRegistry,\n    expressionCompilerFactory: ExpressionCompilerFactory,\n    schema: ISchema,\n    parent: PropertyGroup,\n    path: string,\n    formPropertyFactory: FormPropertyFactory,\n    logger: LogService\n) => {\n    return new ArrayProperty(\n        formPropertyFactory, schemaValidatorFactory, validatorRegistry, expressionCompilerFactory, schema, parent, path, logger);\n};\n","import { AtomicProperty } from './atomicproperty';\nimport { PROPERTY_TYPE_MAPPING } from './typemapping';\nimport { PropertyGroup } from './formproperty';\nimport { ExpressionCompilerFactory } from '../expression-compiler-factory';\nimport { ValidatorRegistry } from './validatorregistry';\nimport { SchemaValidatorFactory } from '../schemavalidatorfactory';\nimport {ISchema} from './ISchema';\nimport { LogService } from '../log.service';\n\nexport class StringProperty extends AtomicProperty {\n\n  fallbackValue() {\n    return '';\n  }\n\n}\n\nPROPERTY_TYPE_MAPPING.string = (\n    schemaValidatorFactory: SchemaValidatorFactory,\n    validatorRegistry: ValidatorRegistry,\n    expressionCompilerFactory: ExpressionCompilerFactory,\n    schema: ISchema,\n    parent: PropertyGroup,\n    path: string,\n    logger: LogService\n) => {\n    return new StringProperty(schemaValidatorFactory, validatorRegistry, expressionCompilerFactory, schema, parent, path, logger);\n};\n","import { AtomicProperty } from './atomicproperty';\nimport { ValidatorRegistry, PropertyGroup } from '.';\nimport { ExpressionCompilerFactory } from '../expression-compiler-factory';\nimport { SchemaValidatorFactory } from '../schemavalidatorfactory';\nimport { PROPERTY_TYPE_MAPPING } from './typemapping';\nimport {ISchema} from './ISchema';\nimport { LogService } from '../log.service';\n\nexport class BooleanProperty extends AtomicProperty {\n\n  fallbackValue() {\n    return null;\n  }\n}\n\nPROPERTY_TYPE_MAPPING.boolean = (\n    schemaValidatorFactory: SchemaValidatorFactory,\n    validatorRegistry: ValidatorRegistry,\n    expressionCompilerFactory: ExpressionCompilerFactory,\n    schema: ISchema,\n    parent: PropertyGroup,\n    path: string,\n    logger: LogService\n) => {\n    return new BooleanProperty(schemaValidatorFactory, validatorRegistry, expressionCompilerFactory, schema, parent, path, logger);\n};\n","import {AtomicProperty} from './atomicproperty';\nimport { ValidatorRegistry, PropertyGroup } from '.';\nimport { ExpressionCompilerFactory } from '../expression-compiler-factory';\nimport { SchemaValidatorFactory } from '../schemavalidatorfactory';\nimport { PROPERTY_TYPE_MAPPING } from './typemapping';\nimport {ISchema} from './ISchema';\nimport { LogService } from '../log.service';\n\nexport class NumberProperty extends AtomicProperty {\n\n  fallbackValue() {\n    return null;\n  }\n\n  setValue(value, onlySelf = false) {\n    if (typeof value === 'string') {\n      if (value.length) {\n        value = value.indexOf('.') > -1 ? parseFloat(value) : parseInt(value, 10);\n      } else {\n        value = null;\n      }\n    }\n    this._value = value;\n    this.updateValueAndValidity(onlySelf, true);\n  }\n}\n\nPROPERTY_TYPE_MAPPING.integer = (\n    schemaValidatorFactory: SchemaValidatorFactory,\n    validatorRegistry: ValidatorRegistry,\n    expressionCompilerFactory: ExpressionCompilerFactory,\n    schema: ISchema,\n    parent: PropertyGroup,\n    path: string,\n    logger: LogService\n) => {\n    return new NumberProperty(schemaValidatorFactory, validatorRegistry, expressionCompilerFactory, schema, parent, path, logger);\n};\n\n PROPERTY_TYPE_MAPPING.number = (\n    schemaValidatorFactory: SchemaValidatorFactory,\n    validatorRegistry: ValidatorRegistry,\n    expressionCompilerFactory: ExpressionCompilerFactory,\n    schema: ISchema,\n    parent: PropertyGroup,\n    path: string,\n    logger: LogService\n) => {\n    return new NumberProperty(schemaValidatorFactory, validatorRegistry, expressionCompilerFactory, schema, parent, path, logger);\n};\n","import { AfterViewInit, Directive } from \"@angular/core\";\nimport { FormControl } from \"@angular/forms\";\n\nimport { ArrayProperty } from \"./model/arrayproperty\";\nimport { FormProperty } from \"./model/formproperty\";\nimport { ObjectProperty } from \"./model/objectproperty\";\nimport { ISchema } from \"./model/ISchema\";\n\nexport abstract class Widget<T extends FormProperty> {\n  formProperty: T;\n  control: FormControl;\n  errorMessages: string[];\n\n  id: string = \"\";\n  name: string = \"\";\n  schema: ISchema = {};\n}\n\n@Directive()\nexport class ControlWidget\n  extends Widget<FormProperty>\n  implements AfterViewInit {\n  ngAfterViewInit() {\n    const control = this.control;\n    this.formProperty.valueChanges.subscribe((newValue) => {\n      if (control.value !== newValue) {\n        control.setValue(newValue, { emitEvent: false });\n      }\n    });\n    this.formProperty.errorsChanges.subscribe((errors) => {\n      control.setErrors(errors, { emitEvent: true });\n      const messages = (errors || [])\n        .filter((e) => {\n          return e.path && e.path.slice(1) === this.formProperty.path;\n        })\n        .map((e) => e.message);\n      this.errorMessages = messages.filter((m, i) => messages.indexOf(m) === i);\n    });\n    control.valueChanges.subscribe((newValue) => {\n      this.formProperty.setValue(newValue, false);\n    });\n  }\n}\n\n@Directive()\nexport class ArrayLayoutWidget\n  extends Widget<ArrayProperty>\n  implements AfterViewInit {\n  ngAfterViewInit() {\n    const control = this.control;\n    this.formProperty.errorsChanges.subscribe((errors) => {\n      control.setErrors(errors, { emitEvent: true });\n    });\n  }\n}\n\n@Directive()\nexport class ObjectLayoutWidget\n  extends Widget<ObjectProperty>\n  implements AfterViewInit {\n  ngAfterViewInit() {\n    const control = this.control;\n    this.formProperty.errorsChanges.subscribe((errors) => {\n      control.setErrors(errors, { emitEvent: true });\n    });\n  }\n}\n","import { Component } from '@angular/core';\n\nimport { ArrayLayoutWidget } from '../../widget';\nimport { FormProperty } from '../../model';\n\n@Component({\n  selector: 'sf-array-widget',\n  template: `<div class=\"widget form-group\">\n\t<label [attr.for]=\"id\" class=\"horizontal control-label\">\n\t\t{{ schema.title }}\n\t</label>\n\t<span *ngIf=\"schema.description\" class=\"formHelp\">{{schema.description}}</span>\n\t<div *ngFor=\"let itemProperty of formProperty.properties\">\n\t\t<sf-form-element [formProperty]=\"itemProperty\"></sf-form-element>\n\t\t<button (click)=\"removeItem(itemProperty)\" class=\"btn btn-default array-remove-button\"\n\t\t\t[disabled]=\"isRemoveButtonDisabled()\" \n\t\t\t*ngIf=\"!(schema.hasOwnProperty('minItems') && schema.hasOwnProperty('maxItems') && schema.minItems === schema.maxItems)\"\n\t\t\t>\n\t\t\t<span class=\"glyphicon glyphicon-minus\" aria-hidden=\"true\"></span> Remove\n\t\t</button>\n\t</div>\n\t<button (click)=\"addItem()\" class=\"btn btn-default array-add-button\"\n\t\t[disabled]=\"isAddButtonDisabled()\"\n\t\t*ngIf=\"!(schema.hasOwnProperty('minItems') && schema.hasOwnProperty('maxItems') && schema.minItems === schema.maxItems)\"\n\t>\n\t\t<span class=\"glyphicon glyphicon-plus\" aria-hidden=\"true\"></span> Add\n\t</button>\n</div>`\n})\nexport class ArrayWidget extends ArrayLayoutWidget {\n  buttonDisabledAdd:boolean\n  buttonDisabledRemove:boolean\n\n  addItem() {\n\tthis.formProperty.addItem();\n\tthis.updateButtonDisabledState()\n  }\n\n  removeItem(item: FormProperty) {\n\tthis.formProperty.removeItem(item);\n\tthis.updateButtonDisabledState()\n  }\n\n  trackByIndex(index: number, item: any) {\n    return index;\n  }\n\n\tupdateButtonDisabledState() {\n\t\tthis.buttonDisabledAdd = this.isAddButtonDisabled()\n\t\tthis.buttonDisabledRemove = this.isRemoveButtonDisabled()\n\t}\n\tisAddButtonDisabled() {\n\t\tif (this.schema.hasOwnProperty('maxItems') && Array.isArray(this.formProperty.properties)) {\n\t\t\tif (this.formProperty.properties.length >= this.schema.maxItems) {\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t\treturn false\n\t}\n\n\tisRemoveButtonDisabled() {\n\t\tif (this.schema.hasOwnProperty('minItems') && Array.isArray(this.formProperty.properties)) {\n\t\t\tif (this.formProperty.properties.length <= this.schema.minItems) {\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t\treturn false\n\t}\n}\n","import {Component} from \"@angular/core\";\n\n@Component({\n  selector: 'sf-button-widget',\n  template: '<button (click)=\"button.action($event)\">{{button.label}}</button>'\n})\nexport class ButtonWidget {\n  public button\n  public formProperty\n}\n","import { Component } from '@angular/core';\n\nimport { ObjectLayoutWidget } from '../../widget';\n\n@Component({\n  selector: 'sf-form-object',\n  template: `<fieldset *ngFor=\"let fieldset of formProperty.schema.fieldsets\">\n\t<legend *ngIf=\"fieldset.title\">{{fieldset.title}}</legend>\n\t<div *ngIf=\"fieldset.description\">{{fieldset.description}}</div>\n\t<div *ngFor=\"let fieldId of fieldset.fields\">\n\t\t<sf-form-element [formProperty]=\"formProperty.getProperty(fieldId)\"></sf-form-element>\n\t</div>\n</fieldset>`\n})\nexport class ObjectWidget extends ObjectLayoutWidget { }\n","import { Component, AfterViewInit } from '@angular/core';\n\nimport { ControlWidget } from '../../widget';\n\n@Component({\n  selector: 'sf-checkbox-widget',\n  template: `<div class=\"widget form-group\">\n    <label [attr.for]=\"id\" class=\"horizontal control-label\">\n        {{ schema.title }}\n    </label>\n\t<div *ngIf=\"schema.type!='array'\" class=\"checkbox\">\n\t\t<label class=\"horizontal control-label\">\n\t\t\t<input [formControl]=\"control\" [attr.name]=\"name\" [attr.id]=\"id\" [indeterminate]=\"control.value !== false && control.value !== true ? true :null\" type=\"checkbox\" [disabled]=\"schema.readOnly\">\n\t\t\t<input *ngIf=\"schema.readOnly\" [attr.name]=\"name\" type=\"hidden\" [formControl]=\"control\">\n\t\t\t{{schema.description}}\n\t\t</label>\n\t</div>\n\t<ng-container *ngIf=\"schema.type==='array'\">\n\t\t<div *ngFor=\"let option of schema.items.oneOf\" class=\"checkbox\">\n\t\t\t<label class=\"horizontal control-label\">\n\t\t\t\t<input [attr.name]=\"name\"\n\t\t\t\t\tvalue=\"{{option.enum[0]}}\" type=\"checkbox\" \n\t\t\t\t\t[attr.disabled]=\"schema.readOnly\"\n\t\t\t\t\t(change)=\"onCheck($event.target)\"\n\t\t\t\t\t[attr.checked]=\"checked[option.enum[0]] ? true : null\"\n\t\t\t\t\t[attr.id]=\"id + '.' + option.enum[0]\"\n\t\t\t\t\t>\n\t\t\t\t{{option.description}}\n\t\t\t</label>\n\t\t</div>\n\t</ng-container>\n</div>`\n})\nexport class CheckboxWidget extends ControlWidget implements AfterViewInit {\n\n\tchecked: any = {};\n\n\tngAfterViewInit() {\n\t\tconst control = this.control;\n\t\tthis.formProperty.valueChanges.subscribe((newValue) => {\n\t\t\tif (control.value !== newValue) {\n\t\t\t\tcontrol.setValue(newValue, { emitEvent: false });\n\t\t\t\tif (newValue && Array.isArray(newValue)) {\n\t\t\t\t\tnewValue.map(v => this.checked[v] = true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.formProperty.errorsChanges.subscribe((errors) => {\n\t\t\tcontrol.setErrors(errors, { emitEvent: true });\n\t\t});\n\t\tcontrol.valueChanges.subscribe((newValue) => {\n\t\t\tthis.formProperty.setValue(newValue, false);\n\t\t});\n\t}\n\n\tonCheck(el) {\n\t\tif (el.checked) {\n\t\t\tthis.checked[el.value] = true;\n\t\t} else {\n\t\t\tdelete this.checked[el.value];\n\t\t}\n\t\tthis.formProperty.setValue(Object.keys(this.checked), false);\n\t}\n}\n","import { Component, AfterViewInit } from '@angular/core';\n\nimport { ControlWidget } from '../../widget';\n\n@Component({\n  selector: 'sf-file-widget',\n  template: `<div class=\"widget form-group\">\n\t<label [attr.for]=\"id\" class=\"horizontal control-label\">\n\t\t{{ schema.title }}\n\t</label>\n    <span *ngIf=\"schema.description\" class=\"formHelp\">{{schema.description}}</span>\n  <input [name]=\"name\" class=\"text-widget file-widget\" [attr.id]=\"id\"\n    [formControl]=\"control\" type=\"file\" [attr.disabled]=\"schema.readOnly?true:null\"\n    (change)=\"onFileChange($event)\">\n\t<input *ngIf=\"schema.readOnly\" [attr.name]=\"name\" type=\"hidden\" [formControl]=\"control\">\n</div>`\n})\nexport class FileWidget extends ControlWidget implements AfterViewInit {\n\n  protected reader = new FileReader();\n  protected filedata: any = {};\n\n  constructor() {\n    super();\n  }\n\n  ngAfterViewInit() {\n    // OVERRIDE ControlWidget ngAfterViewInit() as ReactiveForms do not handle\n    // file inputs\n    const control = this.control;\n    this.formProperty.errorsChanges.subscribe((errors) => {\n      control.setErrors(errors, { emitEvent: true });\n    });\n\n    this.reader.onloadend = () => {\n      this.filedata.data = window.btoa((this.reader.result as string));\n      this.formProperty.setValue(this.filedata, false);\n    };\n  }\n\n  onFileChange($event) {\n    const file = $event.target.files[0];\n    this.filedata.filename = file.name;\n    this.filedata.size = file.size;\n    this.filedata['content-type'] = file.type;\n    this.filedata.encoding = 'base64';\n    this.reader.readAsBinaryString(file);\n  }\n}\n","import {\n  Component,\n} from '@angular/core';\n\nimport { ControlWidget } from '../../widget';\n\n@Component({\n  selector: 'sf-integer-widget',\n  template: `<div class=\"widget form-group\">\n\t<label [attr.for]=\"id\" class=\"horizontal control-label\">\n\t\t{{ schema.title }}\n\t</label>\n  <span *ngIf=\"schema.description\" class=\"formHelp\">{{schema.description}}</span>\n\t<input [attr.readonly]=\"schema.readOnly?true:null\" [attr.name]=\"name\"\n\t[attr.id]=\"id\"\n\tclass=\"text-widget integer-widget form-control\" [formControl]=\"control\"\n\t[attr.type]=\"'number'\" [attr.min]=\"schema.minimum\" [attr.max]=\"schema.maximum\"\n\t[attr.placeholder]=\"schema.placeholder\"\n\t[attr.maxLength]=\"schema.maxLength || null\"\n  [attr.minLength]=\"schema.minLength || null\">\n</div>`\n})\nexport class IntegerWidget extends ControlWidget {}\n","import { Component } from '@angular/core';\n\nimport { ControlWidget } from '../../widget';\n\n@Component({\n  selector: 'sf-textarea-widget',\n  template: `<div class=\"widget form-group\">\n\t<label [attr.for]=\"id\" class=\"horizontal control-label\">\n\t\t{{ schema.title }}\n\t</label>\n    <span *ngIf=\"schema.description\" class=\"formHelp\">{{schema.description}}</span>\n\t<textarea [readonly]=\"schema.readOnly\" [name]=\"name\"\n\t\t[attr.id]=\"id\"\n\t\tclass=\"text-widget textarea-widget form-control\"\n\t\t[attr.placeholder]=\"schema.placeholder\"\n\t\t[attr.maxLength]=\"schema.maxLength || null\"\n    [attr.minLength]=\"schema.minLength || null\"\n\t\t[formControl]=\"control\"></textarea>\n</div>`\n})\nexport class TextAreaWidget extends ControlWidget {}\n","import { Component } from '@angular/core';\n\nimport { ControlWidget } from '../../widget';\n\n@Component({\n  selector: 'sf-radio-widget',\n  template: `<div class=\"widget form-group\">\n\t<label>{{schema.title}}</label>\n    <span *ngIf=\"schema.description\" class=\"formHelp\">{{schema.description}}</span>\n\t<div *ngFor=\"let option of schema.oneOf\" class=\"radio\">\n\t\t<label class=\"horizontal control-label\">\n\t\t\t<input [formControl]=\"control\" [attr.name]=\"name\" [attr.id]=\"id + '.' + option.enum[0]\" value=\"{{option.enum[0]}}\" type=\"radio\"  [disabled]=\"schema.readOnly||option.readOnly\">\n\t\t\t{{option.description}}\n\t\t</label>\n\t</div>\n\t<input *ngIf=\"schema.readOnly\" [attr.name]=\"name\" type=\"hidden\" [formControl]=\"control\">\n</div>`\n})\nexport class RadioWidget extends ControlWidget {}\n","import { Component } from '@angular/core';\n\nimport { ControlWidget } from '../../widget';\n\n@Component({\n  selector: 'sf-range-widget',\n  template: `<div class=\"widget form-group\">\n\t<label [attr.for]=\"id\" class=\"horizontal control-label\">\n\t\t{{ schema.title }}\n\t</label>\n    <span *ngIf=\"schema.description\" class=\"formHelp\">{{schema.description}}</span>\t\n\t<input [name]=\"name\" class=\"text-widget range-widget\" [attr.id]=\"id\"\n\t[formControl]=\"control\" [attr.type]=\"'range'\" [attr.min]=\"schema.minimum\" [attr.max]=\"schema.maximum\" [disabled]=\"schema.readOnly?true:null\" >\n\t<input *ngIf=\"schema.readOnly\" [attr.name]=\"name\" type=\"hidden\">\n</div>`\n})\nexport class RangeWidget extends ControlWidget {}\n","import { Component } from '@angular/core';\n\nimport { ControlWidget } from '../../widget';\n\n@Component({\n\tselector: 'sf-select-widget',\n\ttemplate: `<div class=\"widget form-group\">\n\t<label [attr.for]=\"id\" class=\"horizontal control-label\">\n\t\t{{ schema.title }}\n\t</label>\n\n\t<span *ngIf=\"schema.description\" class=\"formHelp\">\n\t\t{{schema.description}}\n\t</span>\n\n\t<select *ngIf=\"schema.type!='array'\" [formControl]=\"control\" [attr.name]=\"name\" [attr.id]=\"id\" [disabled]=\"schema.readOnly\" [disableControl]=\"schema.readOnly\" class=\"form-control\">\n\t\t<ng-container *ngIf=\"schema.oneOf; else use_enum\">\n\t\t\t<option *ngFor=\"let option of schema.oneOf\" [ngValue]=\"option.enum[0]\" >{{option.description}}</option>\n\t\t</ng-container>\n\t\t<ng-template #use_enum>\n\t\t\t<option *ngFor=\"let option of schema.enum\" [ngValue]=\"option\" >{{option}}</option>\n\t\t</ng-template>\n\t</select>\n\n\t<select *ngIf=\"schema.type==='array'\" multiple [formControl]=\"control\" [attr.name]=\"name\" [attr.id]=\"id\" [disabled]=\"schema.readOnly\" [disableControl]=\"schema.readOnly\" class=\"form-control\">\n    <option *ngFor=\"let option of schema.items.oneOf\" [ngValue]=\"option.enum[0]\" [disabled]=\"option.readOnly\">{{option.description}}</option>\n\t</select>\n\n\t<input *ngIf=\"schema.readOnly\" [attr.name]=\"name\" type=\"hidden\" [formControl]=\"control\">\n</div>`\n})\nexport class SelectWidget extends ControlWidget {}\n","import { Component } from '@angular/core';\n\nimport { ControlWidget } from '../../widget';\n\n@Component({\n  selector: 'sf-string-widget',\n  template: `<input *ngIf=\"this.schema.widget.id ==='hidden'; else notHiddenFieldBlock\"\n  [attr.name]=\"name\" type=\"hidden\" [formControl]=\"control\">\n<ng-template #notHiddenFieldBlock>\n<div class=\"widget form-group\">\n    <label [attr.for]=\"id\" class=\"horizontal control-label\">\n    \t{{ schema.title }}\n    </label>\n    <span *ngIf=\"schema.description\" class=\"formHelp\">{{schema.description}}</span>\n    <input [name]=\"name\" [attr.readonly]=\"(schema.widget.id!=='color') && schema.readOnly?true:null\"\n    class=\"text-widget.id textline-widget form-control\"\n    [attr.type]=\"!this.schema.widget.id || this.schema.widget.id === 'string' ? 'text' : this.schema.widget.id\"\n    [attr.id]=\"id\"  [formControl]=\"control\" [attr.placeholder]=\"schema.placeholder\"\n    [attr.maxLength]=\"schema.maxLength || null\"\n    [attr.minLength]=\"schema.minLength || null\"\n    [attr.required]=\"schema.isRequired || null\"\n    [attr.disabled]=\"(schema.widget.id=='color' && schema.readOnly)?true:null\">\n    <input *ngIf=\"(schema.widget.id==='color' && schema.readOnly)\" [attr.name]=\"name\" type=\"hidden\" [formControl]=\"control\">\n</div>\n</ng-template>`\n})\nexport class StringWidget extends ControlWidget {\n\n    getInputType() {\n        if (!this.schema.widget.id || this.schema.widget.id === 'string') {\n            return 'text';\n        } else {\n            return this.schema.widget.id;\n        }\n    }\n}\n","import { ArrayWidget } from './array/array.widget';\nimport { ButtonWidget } from './button/button.widget';\nimport { CheckboxWidget } from './checkbox/checkbox.widget';\nimport { FileWidget } from './file/file.widget';\nimport { IntegerWidget } from './integer/integer.widget';\nimport { ObjectWidget } from './object/object.widget';\nimport { RadioWidget } from './radio/radio.widget';\nimport { RangeWidget } from './range/range.widget';\nimport { SelectWidget } from './select/select.widget';\nimport { StringWidget } from './string/string.widget';\nimport { TextAreaWidget } from './textarea/textarea.widget';\n\nimport { WidgetRegistry } from '../widgetregistry';\nimport { Injectable } from '@angular/core';\n\n@Injectable()\nexport class DefaultWidgetRegistry extends WidgetRegistry {\n  constructor() {\n    super();\n\n    this.register('array',  ArrayWidget);\n    this.register('object',  ObjectWidget);\n\n    this.register('string', StringWidget);\n    this.register('search', StringWidget);\n    this.register('tel', StringWidget);\n    this.register('url', StringWidget);\n    this.register('email', StringWidget);\n    this.register('password', StringWidget);\n    this.register('color', StringWidget);\n    this.register('date', StringWidget);\n    this.register('date-time', StringWidget);\n    this.register('time', StringWidget);\n\n    this.register('integer', IntegerWidget);\n    this.register('number', IntegerWidget);\n    this.register('range', RangeWidget);\n\n    this.register('textarea', TextAreaWidget);\n\n    this.register('file', FileWidget);\n    this.register('select', SelectWidget);\n    this.register('radio', RadioWidget);\n    this.register('boolean', CheckboxWidget);\n    this.register('checkbox', CheckboxWidget);\n\n    this.register('button', ButtonWidget);\n\n    this.setDefaultWidget(StringWidget);\n  }\n}\n","import { Input, Directive } from '@angular/core'\nimport { NgControl } from '@angular/forms';\n\n@Directive({\n    selector: '[disableControl]'\n})\nexport class DisableControlDirective {\n\n    @Input() set disableControl(condition: boolean) {\n        const action = condition ? 'disable' : 'enable';\n        this.ngControl.control[action]();\n    }\n\n    constructor(private ngControl: NgControl) {\n    }\n\n}","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'sf-default-field',\n  template: `<p>Unknow type</p>`\n})\nexport class DefaultWidget {}\n","import {NgModule, ModuleWithProviders} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {\n  FormsModule,\n  ReactiveFormsModule\n} from '@angular/forms';\n\nimport {FormElementComponent} from './formelement.component';\nimport {FormComponent} from './form.component';\nimport {WidgetChooserComponent} from './widgetchooser.component';\nimport {ArrayWidget} from './defaultwidgets/array/array.widget';\nimport {ButtonWidget} from './defaultwidgets/button/button.widget';\nimport {ObjectWidget} from './defaultwidgets/object/object.widget';\nimport {CheckboxWidget} from './defaultwidgets/checkbox/checkbox.widget';\nimport {FileWidget} from './defaultwidgets/file/file.widget';\nimport {IntegerWidget} from './defaultwidgets/integer/integer.widget';\nimport {TextAreaWidget} from './defaultwidgets/textarea/textarea.widget';\nimport {RadioWidget} from './defaultwidgets/radio/radio.widget';\nimport {RangeWidget} from './defaultwidgets/range/range.widget';\nimport {SelectWidget} from './defaultwidgets/select/select.widget';\nimport {StringWidget} from './defaultwidgets/string/string.widget';\nimport {DefaultWidgetRegistry} from './defaultwidgets/defaultwidgetregistry';\nimport {DisableControlDirective} from './defaultwidgets/_directives/disableControl.directive';\n\nimport {\n  DefaultWidget\n} from './default.widget';\n\nimport {WidgetRegistry} from './widgetregistry';\nimport {SchemaValidatorFactory, ZSchemaValidatorFactory} from './schemavalidatorfactory';\nimport {FormElementComponentAction} from './formelement.action.component';\nimport {ExpressionCompilerFactory, JEXLExpressionCompilerFactory} from './expression-compiler-factory';\n\nimport { LOG_LEVEL, LogLevel, LogService, DefaultLogService } from './log.service';\n\nconst moduleProviders = [\n  {\n    provide: WidgetRegistry,\n    useClass: DefaultWidgetRegistry\n  },\n  {\n    provide: SchemaValidatorFactory,\n    useClass: ZSchemaValidatorFactory\n  },\n  {\n    provide: ExpressionCompilerFactory,\n    useClass: JEXLExpressionCompilerFactory\n  },\n  {\n    provide: LOG_LEVEL,\n    useValue: LogLevel.off\n  },\n  {\n    provide: LogService,\n    useClass: DefaultLogService\n  }\n];\n\n@NgModule({\n  imports: [CommonModule, FormsModule, ReactiveFormsModule],\n  declarations: [\n    FormElementComponent,\n    FormElementComponentAction,\n    FormComponent,\n    WidgetChooserComponent,\n    DefaultWidget,\n    ArrayWidget,\n    ButtonWidget,\n    ObjectWidget,\n    CheckboxWidget,\n    FileWidget,\n    IntegerWidget,\n    TextAreaWidget,\n    RadioWidget,\n    RangeWidget,\n    SelectWidget,\n    StringWidget,\n    DisableControlDirective\n  ],\n  entryComponents: [\n    FormElementComponent,\n    FormElementComponentAction,\n    FormComponent,\n    WidgetChooserComponent,\n    ArrayWidget,\n    ButtonWidget,\n    ObjectWidget,\n    CheckboxWidget,\n    FileWidget,\n    IntegerWidget,\n    TextAreaWidget,\n    RadioWidget,\n    RangeWidget,\n    SelectWidget,\n    StringWidget\n  ],\n  exports: [\n    FormComponent,\n    FormElementComponent,\n    FormElementComponentAction,\n    WidgetChooserComponent,\n    ArrayWidget,\n    ButtonWidget,\n    ObjectWidget,\n    CheckboxWidget,\n    FileWidget,\n    IntegerWidget,\n    TextAreaWidget,\n    RadioWidget,\n    RangeWidget,\n    SelectWidget,\n    StringWidget,\n    DisableControlDirective\n  ]\n})\nexport class SchemaFormModule {\n\n  static forRoot(): ModuleWithProviders<SchemaFormModule> {\n    return {\n      ngModule: SchemaFormModule,\n      providers: [...moduleProviders]\n    };\n  }\n\n}\n","import { Injectable, EventEmitter } from '@angular/core';\n\n@Injectable()\nexport class TemplateSchemaService {\n\n  changes = new EventEmitter();\n\n  constructor() { }\n\n  changed() {\n    this.changes.emit();\n  }\n\n}\n","import { ElementRef } from '@angular/core';\n\nexport class TemplateSchemaElement {\n\n  getTextContent(elementRef: ElementRef): string {\n    const nodes = Array.from(elementRef.nativeElement.childNodes);\n    const node = <HTMLElement>nodes.filter((el: HTMLElement) => {\n      return el.nodeType === el.TEXT_NODE;\n    }).pop();\n\n    if (!node || !node.nodeValue) {\n      return '';\n    }\n\n    return node.nodeValue.trim();\n  }\n\n}\n","import {\n  Component,\n  AfterContentInit,\n  Input,\n  Output,\n  ElementRef,\n  EventEmitter,\n  forwardRef\n} from '@angular/core';\n\nimport { TemplateSchemaElement } from '../template-schema-element';\n\n\n@Component({\n  selector: 'sf-button',\n  templateUrl: './button.component.html',\n  providers: [\n    {\n      provide: TemplateSchemaElement,\n      useExisting: forwardRef(() => ButtonComponent),\n    }\n  ]\n})\nexport class ButtonComponent extends TemplateSchemaElement implements AfterContentInit {\n\n  @Input()\n  id: string;\n\n  @Input()\n  label = '';\n\n  @Input()\n  widget: string | object;\n\n  @Output()\n  click = new EventEmitter<any>();\n\n  constructor(private elementRef: ElementRef) {\n    super();\n  }\n\n  private setLabelFromContent() {\n    const textContent = this.getTextContent(this.elementRef);\n\n    // label as @Input takes priority over content text\n    if (textContent && !this.label) {\n      this.label = textContent;\n    }\n\n  }\n\n  ngAfterContentInit() {\n    this.setLabelFromContent();\n  }\n\n}\n","import { QueryList } from '@angular/core';\n\nimport { Validator } from '../../model/validator';\nimport { ActionRegistry } from '../../model/actionregistry';\nimport { ButtonComponent } from '../button/button.component';\nimport { TemplateSchemaElement } from '../template-schema-element';\n\nimport { Field, FieldType } from './field';\nimport {ISchema} from '../../model/ISchema';\n\nexport abstract class FieldParent extends TemplateSchemaElement {\n\n  name = '';\n  type: FieldType;\n\n  get path(): string {\n    if (!this.name) {\n      return '';\n    }\n\n    return '/' + this.name;\n  }\n\n  protected abstract actionRegistry: ActionRegistry;\n  protected abstract childButtons: QueryList<ButtonComponent>;\n\n\n  getButtons(): { id: string, label: string, widget?: string | object }[] {\n\n    return this.childButtons.map((button, index) => {\n\n      if (!button.id) {\n        const randomString = Math.random().toString(16).substr(2, 8);\n        // generate id for button\n        button.id = this.name + randomString + '_'  + (index + 1);\n      }\n\n      // register as button action the EventEmitter click\n      this.actionRegistry.register(\n        button.id,\n        button.click.emit.bind(button.click)\n      );\n\n      const _button = <any>{\n        id: button.id,\n        label: button.label,\n      };\n\n      if (button.widget) {\n        _button.widget = button.widget;\n      }\n\n      return _button;\n\n    });\n  }\n\n  protected getFieldsValidators(\n    fields: Field[]\n  ): { path: string, validator: Validator }[] {\n\n    return fields.reduce((validators, field) => {\n      return validators.concat(field.getValidators());\n    }, []);\n\n  }\n\n  protected getFieldsSchema(fields: Field[]): ISchema {\n    return fields.reduce((schema: ISchema, field: Field) => {\n\n      switch (this.type) {\n        case FieldType.Array:\n          schema.items = field.getSchema();\n          break;\n\n        default:\n          if (!schema.properties) {\n            schema.properties = {};\n          }\n\n          schema.properties[field.name] = field.getSchema();\n          break;\n      }\n\n      const buttons = field.getButtons();\n      if (buttons.length > 0) {\n        schema.buttons = buttons;\n      }\n\n      if (!field.required) {\n        return schema;\n      }\n\n      if (!schema.required) {\n        schema.required = [];\n      }\n      schema.required.push(field.name);\n      return schema;\n    }, {});\n  }\n\n}\n","import {\n Component,\n ElementRef,\n Input,\n OnInit,\n} from '@angular/core';\n\nimport { TemplateSchemaElement } from '../../template-schema-element';\n\n\n@Component({\n  selector: 'sf-item',\n  templateUrl: './item.component.html'\n})\nexport class ItemComponent extends TemplateSchemaElement implements OnInit {\n\n  @Input()\n  value: any;\n\n  description: string;\n\n  constructor(private elementRef: ElementRef) {\n    super();\n  }\n\n  ngOnInit() {\n    this.description = this.getTextContent(this.elementRef);\n  }\n\n}\n","import {\n  Component,\n  Input,\n  AfterContentInit,\n  ContentChildren,\n  QueryList,\n  ElementRef,\n  SimpleChanges,\n  OnChanges,\n} from '@angular/core';\n\nimport { ActionRegistry } from '../../model/actionregistry';\nimport { Validator } from '../../model/validator';\n\nimport { TemplateSchemaService } from '../template-schema.service';\nimport { ButtonComponent } from '../button/button.component';\n\nimport { FieldParent } from './field-parent';\nimport { FieldType, Field } from './field';\nimport { ItemComponent } from './item/item.component';\nimport { merge } from 'rxjs';\nimport {ISchema} from '../../model/ISchema';\n\n\n@Component({\n  selector: 'sf-field',\n  templateUrl: './field.component.html'\n})\nexport class FieldComponent extends FieldParent implements\nField, OnChanges, AfterContentInit {\n\n  @ContentChildren(FieldComponent)\n  childFields: QueryList<FieldComponent>;\n\n  @ContentChildren(ItemComponent)\n  childItems: QueryList<ItemComponent>;\n\n  @ContentChildren(ButtonComponent)\n  childButtons: QueryList<ButtonComponent>;\n\n  @Input()\n  name: string;\n\n  @Input()\n  type = FieldType.String;\n\n  @Input()\n  format: string;\n\n  @Input()\n  required: boolean;\n\n  @Input()\n  readOnly: boolean;\n\n  @Input()\n  title: string;\n\n  @Input()\n  description: string;\n\n  @Input()\n  placeholder: string;\n\n  @Input()\n  widget: string | object;\n\n  @Input()\n  validator: Validator;\n\n  @Input()\n  schema: ISchema = { };\n\n  constructor(\n    private elementRef: ElementRef,\n    private templateSchemaService: TemplateSchemaService,\n    protected actionRegistry: ActionRegistry\n  ) {\n    super();\n  }\n\n  getSchema(): ISchema {\n\n    const { properties, items, required } = this.getFieldsSchema(\n      this.childFields.filter(field => field !== this)\n    );\n\n    const oneOf = this.getOneOf();\n\n    const schema: ISchema = {\n      type: this.type\n    };\n\n    if (this.title !== undefined) {\n      schema.title = this.title;\n    }\n\n    if (properties !== undefined) {\n      schema.properties = properties;\n    }\n\n    if (items !== undefined) {\n      schema.items = items;\n    }\n\n    // requried child fields\n    if (required !== undefined) {\n      schema.required = required;\n    }\n\n    if (oneOf !== undefined) {\n      schema.oneOf = oneOf;\n    }\n\n    if (this.description !== undefined) {\n      schema.description = this.description;\n    }\n\n    if (this.placeholder !== undefined) {\n      schema.placeholder = this.placeholder;\n    }\n\n    if (this.format !== undefined) {\n      schema.format = this.format;\n    }\n\n    if (this.widget !== undefined) {\n      schema.widget = this.widget;\n    }\n\n    if (this.readOnly !== undefined) {\n      schema.readOnly = this.readOnly;\n    }\n\n    const buttons = this.getButtons();\n    if (buttons.length > 0) {\n      schema.buttons = buttons;\n    }\n\n    // @Input schema takes precedence\n    return Object.assign(schema, this.schema);\n\n  }\n\n  getValidators(): { path: string, validator: Validator }[] {\n\n    // registering validator here is not possible since prop full path is needed\n    const childValidators = this.getFieldsValidators(\n      this.childFields.filter(field => field !== this)\n    );\n    const validators = childValidators.map(({ path, validator }) => {\n      return {\n        path: this.path + path,\n        validator\n      };\n    });\n\n    if (!this.validator) {\n      return validators;\n    }\n\n    validators.push({ path: this.path, validator: this.validator });\n    return validators;\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n\n    const keys = Object.keys(changes);\n    if (keys.length > 0) {\n      for (const key of keys) {\n        if (!changes[key].isFirstChange()) {\n          // on any input change, force schema change generation\n          this.templateSchemaService.changed();\n          break;\n        }\n      }\n    }\n\n  }\n\n\n  private getOneOf() {\n\n    if (this.childItems.length === 0) {\n      return;\n    }\n\n    const items = this.childItems.map(({ value, description }) => {\n      if (!Array.isArray(value)) {\n        return { enum: [value], description };\n      }\n\n      return { enum: value, description };\n    });\n\n    if (items.length === 0) {\n      return;\n    }\n\n    return items;\n  }\n\n\n  private setTitleFromContent() {\n    const textContent = this.getTextContent(this.elementRef);\n\n    //  title as @Input takes priority over content text\n    if (textContent && !this.title) {\n      this.title = textContent;\n    }\n  }\n\n  ngAfterContentInit() {\n\n    // cache it\n    this.setTitleFromContent();\n\n    merge(\n      this.childFields.changes,\n      this.childItems.changes,\n      this.childButtons.changes\n    )\n    .subscribe(() => this.templateSchemaService.changed());\n  }\n\n}\n","import {\n  Directive,\n  ContentChildren,\n  QueryList,\n  AfterContentInit,\n  SimpleChange,\n} from '@angular/core';\nimport { merge } from 'rxjs';\n\nimport { FormComponent } from '../form.component';\nimport { ActionRegistry } from '../model/actionregistry';\nimport { ValidatorRegistry } from '../model/validatorregistry';\nimport { TerminatorService } from '../terminator.service';\n\nimport { TemplateSchemaService } from './template-schema.service';\nimport { FieldComponent } from './field/field.component';\nimport { FieldType } from './field/field';\nimport { ButtonComponent } from './button/button.component';\nimport { FieldParent } from './field/field-parent';\nimport {ISchema} from '../model/ISchema';\n\n\n@Directive({\n  selector: 'sf-form[templateSchema]',\n  providers: [\n    TemplateSchemaService\n  ]\n})\nexport class TemplateSchemaDirective extends FieldParent implements AfterContentInit {\n\n  @ContentChildren(FieldComponent)\n  childFields: QueryList<FieldComponent>;\n\n  @ContentChildren(ButtonComponent)\n  childButtons: QueryList<ButtonComponent>;\n\n  constructor(\n    protected actionRegistry: ActionRegistry,\n    protected validatorRegistry: ValidatorRegistry,\n    private formComponent: FormComponent,\n    private terminatorService: TerminatorService,\n    private templateSchemaService: TemplateSchemaService\n  ) {\n    super();\n  }\n\n  setFormDocumentSchema(fields: FieldComponent[]) {\n      this.actionRegistry.clear();\n      this.validatorRegistry.clear();\n\n      const schema: ISchema = this.getFieldsSchema(fields);\n\n      const validators = this.getFieldsValidators(fields);\n      validators.forEach(({ path, validator }) => {\n        this.validatorRegistry.register(path, validator);\n      });\n\n      const previousSchema: ISchema = this.formComponent.schema;\n      this.formComponent.schema = {\n        type: FieldType.Object,\n        properties: schema.properties\n      };\n\n      if (schema.required && schema.required.length > 0) {\n        this.formComponent.schema.requred = schema.required;\n      }\n\n      const buttons = this.getButtons();\n      if (buttons.length > 0) {\n        this.formComponent.schema.buttons = buttons;\n      }\n\n      this.formComponent.ngOnChanges({\n        schema: new SimpleChange(\n          previousSchema,\n          this.formComponent.schema,\n          Boolean(previousSchema)\n        )\n      });\n\n  }\n\n\n  ngAfterContentInit() {\n\n    if (this.childFields.length > 0) {\n      this.setFormDocumentSchema(this.childFields.toArray());\n    }\n\n    merge(\n      this.childFields.changes,\n      this.templateSchemaService.changes\n    )\n   .subscribe(() => {\n      this.terminatorService.destroy();\n      this.setFormDocumentSchema(this.childFields.toArray());\n    });\n\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { FieldComponent } from './field/field.component';\nimport { TemplateSchemaDirective } from './template-schema.directive';\nimport { ButtonComponent } from './button/button.component';\nimport { ItemComponent } from './field/item/item.component';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  declarations: [\n    TemplateSchemaDirective,\n    FieldComponent,\n    ButtonComponent,\n    ItemComponent\n  ],\n  exports: [\n    TemplateSchemaDirective,\n    FieldComponent,\n    ButtonComponent,\n    ItemComponent\n  ]\n})\nexport class TemplateSchemaModule { }\n"]}